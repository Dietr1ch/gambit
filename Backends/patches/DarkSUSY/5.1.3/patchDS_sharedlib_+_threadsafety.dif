diff -rupN darksusy-5.1.3.pristine/configure darksusy-5.1.3/configure
--- darksusy-5.1.3.pristine/configure	2015-04-07 10:23:05.000000000 +0100
+++ darksusy-5.1.3/configure	2016-02-13 16:18:13.886759474 +0000
@@ -3337,11 +3337,11 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 if test "${FCSET}" = "false" ; then
   if test "${FC}" = "ifort"; then
     echo "Fortran compiler is $FC"
-    FCFLAGS=${FCFLAGS+-O -extend_source}
+    FCFLAGS=${FCFLAGS+-O -extend_source -openmp -fPIC}
   fi
   if test "${FC}" = "gfortran"; then
     echo "Fortran compiler is $FC"
-    FCFLAGS=${FCFLAGS+-O -ffixed-line-length-none}
+    FCFLAGS=${FCFLAGS+-O -ffixed-line-length-none -fopenmp -fPIC}
   fi
 fi
 
diff -rupN darksusy-5.1.3.pristine/configure.ac darksusy-5.1.3/configure.ac
--- darksusy-5.1.3.pristine/configure.ac	2015-04-07 10:23:05.000000000 +0100
+++ darksusy-5.1.3/configure.ac	2016-02-05 14:35:08.231004284 +0000
@@ -28,11 +28,11 @@ AC_PROG_FC([ifort gfortran])
 if test "${FCSET}" = "false" ; then
   if test "${FC}" = "ifort"; then 
     echo "Fortran compiler is $FC"
-    FCFLAGS=${FCFLAGS+-O -extend_source}
+    FCFLAGS=${FCFLAGS+-O -extend_source -openmp -fPIC}
   fi 
   if test "${FC}" = "gfortran"; then
     echo "Fortran compiler is $FC"
-    FCFLAGS=${FCFLAGS+-O -ffixed-line-length-none}
+    FCFLAGS=${FCFLAGS+-O -ffixed-line-length-none -fopenmp -fPIC}
   fi
 fi
 
Binary files darksusy-5.1.3.pristine/contrib/FeynHiggs-2.9.4/libFH.so and darksusy-5.1.3/contrib/FeynHiggs-2.9.4/libFH.so differ
diff -rupN darksusy-5.1.3.pristine/contrib/FeynHiggs-2.9.4/makefile.in darksusy-5.1.3/contrib/FeynHiggs-2.9.4/makefile.in
--- darksusy-5.1.3.pristine/contrib/FeynHiggs-2.9.4/makefile.in	2013-02-10 06:43:34.000000000 +0000
+++ darksusy-5.1.3/contrib/FeynHiggs-2.9.4/makefile.in	2016-02-16 15:26:02.949096912 +0000
@@ -31,6 +31,9 @@ ARGS = $(PARALLEL) \
 default all lib frontend mma: force
 	cd $(BLD) && $(MAKE) $(ARGS) $@
 
+lib_shared: lib
+	$(FC) $(FFLAGS) -shared -o $(DS_LIB)/libFH.so build/*.o
+
 install: default
 	-mkdir "$(PREFIX)"
 	-mkdir "$(LIBDIR)" "$(INCLUDEDIR)" "$(BINDIR)"
diff -rupN darksusy-5.1.3.pristine/contrib/FeynHiggs-2.9.4/src/Decays/VecSet.F darksusy-5.1.3/contrib/FeynHiggs-2.9.4/src/Decays/VecSet.F
--- darksusy-5.1.3.pristine/contrib/FeynHiggs-2.9.4/src/Decays/VecSet.F	2013-02-10 06:43:34.000000000 +0000
+++ darksusy-5.1.3/contrib/FeynHiggs-2.9.4/src/Decays/VecSet.F	2016-02-03 09:19:30.694574453 +0000
@@ -27,7 +27,7 @@
 #define EpsL(x,y)  vec_(x,y, 3, i)
 #define EpsTL(x,y) vec_(x,y, 4, i)
 
-	ComplexType spi_(2, 6:7, nvec, 1)
+	ComplexType spi_(2, 6:7, nvec, LEGS)
 	equivalence (vec, spi_)
 
 #define Spi(hel,om,x) spi_(x, om, hel+6, i)
Binary files darksusy-5.1.3.pristine/contrib/HiggsBounds-3.8.1/HiggsBounds/libHB.so and darksusy-5.1.3/contrib/HiggsBounds-3.8.1/HiggsBounds/libHB.so differ
diff -rupN darksusy-5.1.3.pristine/contrib/HiggsBounds-3.8.1/HiggsBounds/makefile_darksusy.in darksusy-5.1.3/contrib/HiggsBounds-3.8.1/HiggsBounds/makefile_darksusy.in
--- darksusy-5.1.3.pristine/contrib/HiggsBounds-3.8.1/HiggsBounds/makefile_darksusy.in	2015-04-07 10:23:05.000000000 +0100
+++ darksusy-5.1.3/contrib/HiggsBounds-3.8.1/HiggsBounds/makefile_darksusy.in	2016-02-16 15:28:43.937094029 +0000
@@ -106,10 +106,10 @@ OBJSsubroutines =  $(OBJSbasic) \
 default: HiggsBounds
 
 %.o: %.f
-	$(F77C) -c $< -o $@
+	$(F77C) $(F90FLAGS) -c $< -o $@
 
 %.o: %.F
-	$(F77C) -c $< -o $@
+	$(F77C) $(F90FLAGS) -c $< -o $@
 
 %.o %.mod: %.f90
 	$(F90C) $(F90FLAGS) $(ADDITIONALDEFINE) -c $< 
@@ -138,6 +138,17 @@ libHB:  $(MODS) $(OBJSsubroutines)
 
 libHB.a: libHB
 
+libHB_shared:  $(MODS) $(OBJSsubroutines)
+	$(F90C) $(F90FLAGS) -shared -o $(DS_LIB)/libHB.so $(OBJSsubroutines)
+	rm -f Expt_tables/S95_t1.binary 
+	rm -f Expt_tables/S95_t2.binary 
+	rm -f Theory_tables/BRSM.binary 	
+	touch Expt_tables/S95_t1.binary 
+	touch Expt_tables/S95_t2.binary 
+	touch Theory_tables/BRSM.binary 
+
+libHB.so: libHB_shared
+
 HBwithFH:  libHB.a
 	$(F77C) $(FHINCLUDE) example_programs/HBwithFH.F -o example_programs/HBwithFH $(FHLIBS) $(HBLIBS)
 	$(F90C) $(FHINCLUDE) example_programs/HBSLHAinputblocksfromFH_extras.F example_programs/HBSLHAinputblocksfromFH.F90 -o example_programs/HBSLHAinputblocksfromFH $(FHLIBS) $(HBLIBS)
@@ -157,10 +168,9 @@ clean:
 	rm -f *.o *.mod *.MOD *.a
 	rm -f store_pathname.f90
 
-hyperclean:
-	rm -f *.o *.mod *.MOD *.a *~ 
+hyperclean: clean
+	rm -f *~ 
 	rm -f example_programs/*~ 
-	rm -f store_pathname.f90
 	rm -f example_programs/HBwithFH
 	rm -f example_programs/HBwithCPsuperH
 	rm -f example_programs/example-SM_vs_4thGen
diff -rupN darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/func.f darksusy-5.1.3/contrib/isajet781-for-darksusy/func.f
--- darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/func.f	2011-11-03 14:34:52.000000000 +0000
+++ darksusy-5.1.3/contrib/isajet781-for-darksusy/func.f	1970-01-01 01:00:00.000000000 +0100
@@ -1,189 +0,0 @@
-
-******************************************************************
-******************************************************************
-******************************************************************
-      FUNCTION FUNC(X)
-
-
-      IMPLICIT NONE
-      
-      CHARACTER*6 PINF,PN1,PN2
-      REAL*8 A
-      COMMON/VARS/A(1800)
- 
-      COMMON /CTRL/
-     &AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX,
-     &NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-
-      REAL*8 AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX
-      INTEGER NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-      
-      REAL*8 X(25)
-      REAL*8 P(0:3,4)
-
-      REAL*8 RR,SN,PI,GEVTOPBN,FUNC,ds_da_dc,AS_MIN,PM,E,XMASS,Z,
-     &COS1, PM1,PM2,PM3,PM4,SIN1,SFACT,CFACT,TFACT,B1,B2,FA,AS,DJACOB,
-     &ECM,XFA,FA12,E1,E2,R1,R2,E3,R3,E4,R4,F_PS,FA12_integr,FUNC_TMP,
-     &SQME
-     
-      INTEGER I
-      
-      RR(E,XMASS)  = SQRT(MAX(0d0,(E-XMASS)*(E+XMASS)))
-      SN(Z)        = SQRT(MAX(0d0,(1-z)*(1+z)))
-      
-      
-      PI=DACOS(-1d0)
-      GEVTOPBN= 0.3893796623*1.E+09      
-      
-      FUNC=0.
-      ds_da_dc=0.
-      
-
- 
-      AS_MIN=2d0
-      PM=abs(A(93))
-C------------------------------------------ 
-      COS1=1d0-2d0*X(1)
-
-
-      IF(COS1.gt.COS_MAX) goto 999
-      IF(COS1.lt.cos_min) goto 999
-      SIN1=SN(COS1)
-
-
-C------------------------------------------      
-	
-      DO I =NPROC_MIN,NPROC_MAX,NPROC_STEP
-        
-        CALL PMAS(I,1,PM1)
-        CALL PMAS(I,2,PM2)
-	IF(ABS(PM1/PM).gt.SUPPEXPMAX.or.ABS(PM2/PM).gt.SUPPEXPMAX) 
-     >  goto 900
-        CALL PMAS(I,3,PM3)
-        CALL PMAS(I,4,PM4)
-	
-	PN1=PINF(I,1)
-        PN2=PINF(I,2)
-	SFACT=1.
-	CFACT=1.
-
-	IF(PN1.ne.PN2) SFACT=2.
-
-	IF(PN1.ne.'~o1'.and.PN1.ne.'~o2'.and.PN1.ne.'~g')  CFACT=2.
-	IF(PN2.ne.'~o1'.and.PN2.ne.'~o2'.and.PN2.ne.'~g')  CFACT=2.
-	
-	IF(PN1.eq.'~1+'.and.PN2.eq.'~1-')  CFACT=1.
-	
-	IF(PN1.eq.'~e1'.and.PN2.eq.'~E1')  CFACT=1.
-	IF(PN1.eq.'~e2'.and.PN2.eq.'~E2')  CFACT=1.
-	IF(PN1.eq.'~e3'.and.PN2.eq.'~E3')  CFACT=1.
-	IF(PN1.eq.'~n1'.and.PN2.eq.'~N1')  CFACT=1.
-	IF(PN1.eq.'~n2'.and.PN2.eq.'~N2')  CFACT=1.
-	IF(PN1.eq.'~n3'.and.PN2.eq.'~N3')  CFACT=1.
-	IF(PN1.eq.'~u1'.and.PN2.eq.'~U1')  CFACT=1.
-	IF(PN1.eq.'~d1'.and.PN2.eq.'~D1')  CFACT=1.
-	IF(PN1.eq.'~c1'.and.PN2.eq.'~C1')  CFACT=1.
-	IF(PN1.eq.'~s1'.and.PN2.eq.'~S1')  CFACT=1.
-	IF(PN1.eq.'~t1'.and.PN2.eq.'~T1')  CFACT=1.
-	IF(PN1.eq.'~b1'.and.PN2.eq.'~B1')  CFACT=1.
-	
-	TFACT=SFACT*CFACT
-	
-     
-      
-	
-	pm1=abs(pm1)
-	pm2=abs(pm2)
-	pm3=abs(pm3)
-	pm4=abs(pm4)
-	
-      
-	
-	B1=pm1/pm
-	B2=pm2/pm
-        
-	
-     
-        IF(NDIMUSER.eq.1) then
-          FA=1.
-          AS=AS_MAX
-          DJACOB=2.
-        ELSEIF(NDIMUSER.ge.2) then
-	
-          AS=AS_MIN+(AS_MAX-AS_MIN)*X(2)
-          DJACOB=(AS_MAX-AS_MIN)*2.
-	  IF(AS.le.b1+b2) goto 900
-	  
-	  IF(NDIMUSER.eq.2) THEN
-	      FA=FA12(AS,I,XF)
-	      
-	    
-	  ELSEIF(NDIMUSER.eq.3.and.NDIMUSER_EFF.eq.2) THEN
-	
-   	      FA=FA12_integr(AS,b1,b2,XF)*
-     &        ((AS**2-b1**2-b2**2)**2-4.*b1**2*b2**2)
-     &        /sqrt(AS)/(2.*sqrt(2.*pi)*b1**(3./2.)*b2**(3./2.))
-
-         
-          ELSEIF(NDIMUSER.eq.3.and.NDIMUSER_EFF.eq.3) THEN
-	      XFA=X(3)
-	      FA=FA12(AS,I,XFA)
-	      
-          ENDIF
-      
-        ENDIF
-	
-         
-        ECM=AS*PM
-        IF(ECM.GT.max(PM1+PM2,PM3+PM4)) then
-	
-	
-          E1=(ECM+(PM1-PM2)*(PM1+PM2)/ECM)/2D0
-          E2=(ECM+(PM2-PM1)*(PM1+PM2)/ECM)/2D0
-          R1=RR(E1,PM1)
-          R2=R1
- 	
-          P(0,1)=E1
-          P(1,1)=0.
-          P(2,1)=0.
-          P(3,1)=-R1
-          P(0,2)=E2
-          P(1,2)=0.
-          P(2,2)=0.
-          P(3,2)=R1
-	
-          E3=(ECM+(PM3-PM4)*(PM3+PM4)/ECM)/2D0
-          R3=RR(E3,PM3)
-          E4=(ECM+(PM4-PM3)*(PM3+PM4)/ECM)/2D0
-          R4=R3
-
-          P(0,3)=E3
-          P(1,3)=R3*SIN1
-          P(2,3)=0.
-          P(3,3)=R3*COS1
-         
-	  P(0,4)=E4
-          P(1,4)=-P(1,3)
-          P(2,4)=0.
-          P(3,4)=-P(3,3)
-           
-       	 
-	  F_PS=R3/R1/(32d0*Pi*ECM**2)
-	  FUNC_TMP =TFACT*SQME(I,P)*F_PS*FA*DJACOB*GEVTOPBN
-          ds_da_dc=FUNC_TMP+ds_da_dc
-	  IF(I.eq.26.and.NDIMUSER.eq.3.and.NDIMUSER_EFF.eq.2) goto 999
-	  
-	  
-        ENDIF
-  900   CONTINUE     
-
-      ENDDO
-  999 FUNC=ds_da_dc
-       
-
-      IF(FUNC.le.1D-16) FUNC=1D-16
- 
-      return
-      end
diff -rupN darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/func_int.f darksusy-5.1.3/contrib/isajet781-for-darksusy/func_int.f
--- darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/func_int.f	2011-11-03 14:34:52.000000000 +0000
+++ darksusy-5.1.3/contrib/isajet781-for-darksusy/func_int.f	1970-01-01 01:00:00.000000000 +0100
@@ -1,69 +0,0 @@
-
-
-C-------------------------------------------------------
-C#######################################################
-C-------------------------------------------------------
-
-      FUNCTION FUNC_INT(IPRINT)
-      IMPLICIT NONE
-C------- BASES COMMON BLOCKS ---------------------
-      
-      EXTERNAL FUNC
-      REAL*8  FUNC_INT,FUNC
-      
-      INTEGER NDIM,IG,MXDIM,NWILD,NCALL
-      REAL*8 XL,XU
-      PARAMETER (MXDIM = 50 )                                           
-      COMMON /BPARM1/ XL(MXDIM),XU(MXDIM),NDIM,NWILD,IG(MXDIM),NCALL    
-c      DATA NWILD/2/,NCALL/1000/      
-      INTEGER INTV, IPNT, NLOOP, MLOOP,ITMX1,ITMX2
-      REAL*8 ACC1,ACC2
-      COMMON /BPARM2/ ACC1,ACC2,ITMX1,ITMX2                             
-c      DATA  ITMX1/5/,ITMX2/5/,ACC1/0.1d0/,ACC2/0.1d0/
-      COMMON /BSCNTL/ INTV, IPNT, NLOOP, MLOOP      
-c---------------------------------------------------
-      REAL*8 ESTIM, SIGMA, CTIME
-
-     
-      COMMON /CTRL/
-     &AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX,
-     &NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-
-      REAL*8 AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX
-      INTEGER NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-     
-      INTEGER I,IPRINT,IT1,IT2
-      
-      CALL BSINIT 
-      
-      ITMX1=5
-      ITMX2=5
-      NDIM =NDIMUSER_EFF
-      NWILD=NDIM
-      ACC1=1.
-      ACC2=1.
-      
-      DO 1 I=1,NDIMUSER_EFF
-        XL(I)=0d0
-        XU(I)=1d0
-    1 CONTINUE
-      XL(3)=0.000001
-      XU(3)=XF
-   
-c-------------------------------------------------
-
-      INTV=IPRINT
-      
-c       print *,'NCALLS=', NCALL,IPRINT,INTV,NPROC_MIN,NPROC_MAX
-      
-c      CALL BSINIT                                                  
-      CALL BASES( FUNC, ESTIM, SIGMA, CTIME, IT1, IT2 )             
-      
-      FUNC_INT=ESTIM
-      
-     
-      
-      RETURN
-      END
diff -rupN darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/isared.f darksusy-5.1.3/contrib/isajet781-for-darksusy/isared.f
--- darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/isared.f	2011-11-03 14:34:52.000000000 +0000
+++ darksusy-5.1.3/contrib/isajet781-for-darksusy/isared.f	1970-01-01 01:00:00.000000000 +0100
@@ -1,391 +0,0 @@
-CDECK  ID>, ISARED.
-cccccccccccccccccccccccccccccccccccccccccccccc
-c      AUTHORS: Baer,Balazs,Belyaev
-c
-c      Last modification -> 10/27/2005 A.Belyaev
-c      Last modification -> 10/04/2007 A.Belyaev
-c      Last modification -> 12/06/2007 A.Belyaev -> sigma*v (v->0) added
-c
-cccccccccccccccccccccccccccccccccccccccccccccc
-     
-      SUBROUTINE ISARED(IPRT)
-c      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
-      IMPLICIT NONE
-      
-	
-c----------USER--------------------------------      
-      COMMON /CTRL/
-     &AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX,
-     &NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-
-      REAL*8 AS_MAX,XFINI,XF,COS_MIN,COS_MAX,CS_MIN,SUPPEXP, SUPPEXPMAX
-      INTEGER NDIMUSER,NDIMUSER_EFF,ISUM,NST_MAX,
-     &NPROC_MIN,NPROC_MAX,NPROC_STEP
-     
-
-      INTEGER IPRINT
-      
-      DATA   AS_MAX / 3D0 /, XFINI/0.05D0/, NDIMUSER/3/, NST_MAX/10/,
-     &      NPROC_MIN/1/,   NPROC_MAX/1820/, NPROC_STEP/1/, IPRINT/1/,
-     &      COS_MIN / -0.999999d0 / , COS_MAX / 0.999999d0 /,
-     &      CS_MIN  /0d0/, ISUM/1/, SUPPEXPMAX/2d0/
-     
-
-      common/printlevel/NPRINT
-      INTEGER NPRINT
-c-----------------------------------------------      
-      COMMON   /GOOD/    NNOGOOD,IALLOW 
-      INTEGER  NNOGOOD,IALLOW                                                                                                       
-c------BASES------------------------------------\
-     
-      INTEGER NDIM,IG,MXDIM,NWILD,NCALL
-      REAL*8 XL,XU
-   
-      PARAMETER (MXDIM = 50 )                                           
-      COMMON /BPARM1/ XL(MXDIM),XU(MXDIM),NDIM,NWILD,IG(MXDIM),NCALL    
-      DATA NWILD/2/,NCALL/1000/      
-      
-      INTEGER INTV, IPNT, NLOOP, MLOOP,ITMX1,ITMX2
-      REAL*8 ACC1,ACC2
-      COMMON /BPARM2/ ACC1,ACC2,ITMX1,ITMX2                             
-      DATA  ITMX1/5/,ITMX2/5/,ACC1/1d0/,ACC2/1d0/
-      COMMON /BSCNTL/ INTV, IPNT, NLOOP, MLOOP                          
-c-----------------------------------------------
-      REAL*8 xb,g,pm
-      CHARACTER*6 names
-      INTEGER J,idof,IPTOT
-      COMMON /INPART/ xb(29),g(29),pm(29),idof(29),IPTOT
-      COMMON /NAMES/ names(29)
-
-      DATA IPTOT/29/
-      DATA  (IDOF(J),J=1,29)
-     _/  2,     2 ,     16,
-     _   2 ,	1 ,     1,      1,      3,     3, 
-     _  	1 ,     1 ,     1,      3,     3,    3,    3,
-     _   2 ,    1 ,     1,      1,      3,     3,
-     _  	1 ,     1 ,     1,      3,     3,    3,    3/
-
-     
-      DATA  (NAMES(J),J=1,29)
-     _/'~o1',  '~o2' ,'~g',
-     _  '~1-' ,'~e1' , '~e2' , '~e3' ,'~t1','~b1', 
-     _         '~n1' , '~n2' , '~n3' ,'~u1','~d1','~c1','~s1',
-     _  '~1+' ,'~E1' , '~E2' , '~E3' ,'~T1','~B1', 
-     _         '~N1' , '~N2' , '~N3' ,'~U1','~D1','~C1','~S1'/
-c-----------------------------------------------
-      REAL*4 OMGH2,SIGMA,XFREEZ,FFF_V
-      INTEGER NSTEPS
-      COMMON/SUGRED/ OMGH2,SIGMA,XFREEZ,NSTEPS,FFF_V
-c-----ISAJET-----------------------------------   
-      COMMON/SSLUN/LOUT,LHEOUT
-      INTEGER LOUT,LHEOUT
-      SAVE /SSLUN/
-C     XSUGIN contains the inputs to SUGRA:
-C     XSUGIN(1) = M_0        XSUGIN(2) = M_(1/2)  XSUGIN(3) = A_0
-C     XSUGIN(4) = tan(beta)  XSUGIN(5) = sgn(mu)  XSUGIN(6) = M_t
-C     XSUGIN(7) = SUG BC scale
-C     XGMIN(1) = LAM         XGMIN(2)  = M_MES    XGMIN(3)  = XN5
-C     XGMIN(4) = tan(beta)   XGMIN(5)  = sgn(mu)  XGMIN(6) = M_t
-C     XGMIN(7) = CGRAV       XGMIN(8)  =RSL       XGMIN(9)  = DEL_HD
-C     XGMIN(10)  = DEL_HU    XGMIN(11) = DY       XGMIN(12) = N5_1
-C     XGMIN(13)  = N5_2      XGMIN(14) = N5_3
-C     XNRIN(1) = M_N3        XNRIN(2) = M_MAJ     XNRIN(3) = ANSS 
-C     XNRIN(4) = M_N3SS
-C     XISAIN contains the MSSMi inputs in natural order.
-      COMMON /SUGXIN/ XISAIN(24),XSUGIN(7),XGMIN(14),XNRIN(4),
-     $XAMIN(11)
-      REAL XISAIN,XSUGIN,XGMIN,XNRIN,XAMIN
-      SAVE /SUGXIN/
-C          Frozen couplings from RG equations:
-C     GSS( 1) = g_1        GSS( 2) = g_2        GSS( 3) = g_3
-C     GSS( 4) = y_tau      GSS( 5) = y_b        GSS( 6) = y_t
-C     GSS( 7) = M_1        GSS( 8) = M_2        GSS( 9) = M_3
-C     GSS(10) = A_tau      GSS(11) = A_b        GSS(12) = A_t
-C     GSS(13) = M_hd^2     GSS(14) = M_hu^2     GSS(15) = M_er^2
-C     GSS(16) = M_el^2     GSS(17) = M_dnr^2    GSS(18) = M_upr^2
-C     GSS(19) = M_upl^2    GSS(20) = M_taur^2   GSS(21) = M_taul^2
-C     GSS(22) = M_btr^2    GSS(23) = M_tpr^2    GSS(24) = M_tpl^2
-C     GSS(25) = mu         GSS(26) = B          GSS(27) = Y_N
-C     GSS(28) = M_nr       GSS(29) = A_n        GSS(30) = vdq
-C     GSS(31) = vuq
-C          Masses:
-C     MSS( 1) = glss     MSS( 2) = upl      MSS( 3) = upr
-C     MSS( 4) = dnl      MSS( 5) = dnr      MSS( 6) = stl
-C     MSS( 7) = str      MSS( 8) = chl      MSS( 9) = chr
-C     MSS(10) = b1       MSS(11) = b2       MSS(12) = t1
-C     MSS(13) = t2       MSS(14) = nuel     MSS(15) = numl
-C     MSS(16) = nutl     MSS(17) = el-      MSS(18) = er-
-C     MSS(19) = mul-     MSS(20) = mur-     MSS(21) = tau1
-C     MSS(22) = tau2     MSS(23) = z1ss     MSS(24) = z2ss
-C     MSS(25) = z3ss     MSS(26) = z4ss     MSS(27) = w1ss
-C     MSS(28) = w2ss     MSS(29) = hl0      MSS(30) = hh0
-C     MSS(31) = ha0      MSS(32) = h+
-C          Unification:
-C     MGUTSS  = M_GUT    GGUTSS  = g_GUT    AGUTSS  = alpha_GUT
-      COMMON /SUGMG/ MSS(32),GSS(31),MGUTSS,GGUTSS,AGUTSS,FTGUT,
-     $FBGUT,FTAGUT,FNGUT
-      REAL MSS,GSS,MGUTSS,GGUTSS,AGUTSS,FTGUT,FBGUT,FTAGUT,FNGUT
-      SAVE /SUGMG/
-      COMMON /SUGPAS/ XTANB,MSUSY,AMT,MGUT,MU,G2,GP,V,VP,XW,
-     $A1MZ,A2MZ,ASMZ,FTAMZ,FBMZ,B,SIN2B,FTMT,G3MT,VEV,HIGFRZ,
-     $FNMZ,AMNRMJ,NOGOOD,IAL3UN,ITACHY,MHPNEG,MHLNEG,MHCNEG,
-     $IGUTST,ASM3,
-     $VUMT,VDMT,ASMTP,ASMSS,M3Q,MHDSQ,MHUSQ,MHDSMG,MHUSMG,MUMG,BMG,
-     $FT2Z1,FB2Z1,FL2Z1
-      REAL XTANB,MSUSY,AMT,MGUT,MU,G2,GP,V,VP,XW,
-     $A1MZ,A2MZ,ASMZ,FTAMZ,FBMZ,B,SIN2B,FTMT,G3MT,VEV,HIGFRZ,
-     $FNMZ,AMNRMJ,ASM3,VUMT,VDMT,ASMTP,ASMSS,M3Q,MHDSQ,MHUSQ,
-     $MHDSMG,MHUSMG,MUMG,BMG,FT2Z1,FB2Z1,FL2Z1
-      INTEGER NOGOOD,IAL3UN,ITACHY,MHPNEG,MHLNEG,MHCNEG,IGUTST
-      SAVE /SUGPAS/
-c----------COMPHEP------------------------------      
-      COMMON/VARS/A(1800)
-      REAL*8 A
-c-----------------------------------------------      
-c-----------------------------------------------      
-      CHARACTER*6 PINF
-      REAL*8 PBNTOGEV,PI,SQRT_GN,FFF,XFI,XF_OLD,SUMM,GEFF,
-     &FUNC_INT,FFF_TMP,OMEGA,FFF_OLD
-      
-      INTEGER IPRT,NPROC_MAX_S,NPROC_MIN_S,IPM,IDEL,
-     &NDIMUSER_SAVE,NST,NDIMUSER_EFF_SAVE, NCALL_SAV,I
-    
-      
-c-----------------------------------------------      
-      REAL*8 del(29)
-    
-      REAL*8 vvv,AS_MAX_SAVE,conv1,conv2,CS_V
-      
-      
-      IPRINT=IPRT
-      NPRINT=IPRINT
-      
-      XF=XFINI
-      FFF=0d0
-	
-      SQRT_GN=dsqrt(67.07d0)/1d+20
-      PBNTOGEV=1d0/0.3893796623/1d+09	
-       
-      Pi=DACOS(-1d0)
-      
-      FFF=0
-      NNOGOOD=0
-      
-      call vini
-***************************
-
-      call isachp
-
-*****************************
-! Z1,Z2,W1, e1, e2, e3, n1,n2,n3,u1,d1,c1,s1,t1,b1,gss
-****************************
-	PM(1)=abs(A(93))   	!neutr1
-        PM(2)=abs(A(95))   	!neutr2
-        PM(3)=abs(A(131))  	!gluino
-	
-        PM(4)=abs(A(89))   	!charg
-        PM(5)=abs(A(132))  	!sel
-        PM(6)=abs(A(134))  	!smu
-        PM(7)=abs(A(106))  	!sta
-        PM(8)=abs(A(122))   	!stop
-        PM(9)=abs(A(126))  	!sbot
-	
-   	
-        PM(10)=abs(A(136))  	!snu_e
-        PM(11)=abs(A(137))  	!snu_l
-        PM(12)=abs(A(112))  	!snu_tau
-        PM(13)=abs(A(138))  	!sup1
-        PM(14)=abs(A(140))  	!sd_1
-        PM(15)=abs(A(142))  	!sc1
-        PM(16)=abs(A(144))  	!ss_1
-	
-        PM(17)=	PM(4)		!charg
-        PM(18)=	PM(5)  		!sel
-        PM(19)=	PM(6)  		!smu
-        PM(20)=	PM(7)  		!sta
-        PM(21)=	PM(8)		!stop
-        PM(22)=	PM(9)  		!sbot
-	
- 
-        PM(23)=	PM(10)  	!snu_e
-        PM(24)=	PM(11)  	!snu_l
-        PM(25)=	PM(12)  	!snu_tau
-        PM(26)=	PM(13)  	!sup1
-        PM(27)=	PM(14)  	!sd_1
-        PM(28)=	PM(15)  	!sc1
-        PM(29)=	PM(17)  	!ss_1
-***********************************************      
-
- 
-      SUPPEXP=1E+20
- 
-      DO IPM=2,IPTOT
-        if(min(pm(IPM),PM(1)).ne.pm(1).and.iallow.eq.0) then
-          iallow=-11 !NEUTR IS NOT THE LIGHTEST
-          if(iprt.gt.2) print *,'Z1 IS NOT LSP',IPM,PM(IPM),PM(1)
-          NNOGOOD=5
-          goto 555
-          ENDIF 
-          SUPPEXP=min(SUPPEXP,pm(IPM)/pm(1))
-      ENDDO
-
-      geff=0d0
-      DO IDEL=1,IPTOT
-        del(idel)=(pm(idel)-pm(1))/pm(1)
-        geff=geff+ 2. * (1.+del(IDEL))**(3./2.) * Exp(-del(idel)/XF)
-        if(iprint.gt.2) 
-     &print *,  (1.+del(IDEL))**(3./2.) * Exp(-del(idel)/XF), del(idel)
-      ENDDO
-      IF(IPRINT.gt.1) print *,'GEFF=', GEFF,'   ','SUPPEXP=',SUPPEXP
-      NDIMUSER_EFF=NDIMUSER
-      IF(SUPPEXP.ge.SUPPEXPMAX.and.NDIMUSER.eq.3)  NDIMUSER_EFF=2 
-      if(iprint.gt.2) 
-     & print *, 'NDIMUSER_EFF=', NDIMUSER_EFF,SUPPEXP
-     
-
-cccccccccccccccccc    
-c      goto 111
-
-      NST=0
-      NDIMUSER_SAVE=NDIMUSER
-      NDIMUSER_EFF_SAVE=NDIMUSER_EFF
-c       print *,'ISARED:', NPROC_MIN,NPROC_MAX
-
-      IF(NDIMUSER.ge.2) NDIMUSER=2
-      NDIMUSER_EFF=NDIMUSER
-      NCALL_SAV=NCALL
-      NCALL=NCALL/2.
-888   continue
-      NST=NST+1
-      IF(NST.GT.NST_MAX) goto 666
-      
-      IPRINT=IPRT
-c--------------------	
-      FFF_OLD=FFF  
-      FFF=FUNC_INT(IPRINT)
-      IF(FFF.lt.CS_MIN) GOTO  666
-c--------------------	  
-
-      IF(NDIMUSER_SAVE.eq.2) GOTO 777
-      if(IPRT.gt.1) print *,'FFF0=', FFF
-
-        
-      IF(FFF.le.0) then
-         FFF=0.
-         goto 666
-      ENDIF
-
-
-       XFI=LOG(
-     &     PM(1)/(2d0*Pi**3)*geff/2d0*sqrt(45d0/(2d0*81d0))/SQRT_GN
-     &     *FFF*PBNTOGEV*SQRT(XF)
-     &     )
-       
-
-       XF_OLD=XF
-       XF=1D0/XFI
-       
-
-
-       IF(iprint.gt.1) then
-       print *,'======================='
-       print *,'XF = ',XF,1d0/XF
-       print *,'CS  = ',FFF
-       print *,'NST = ',NST
-       print *,'======================='
-       endif
-
-       IF(XF.le.0.) then
-         XF=XFINI
-         FFF=0
-         goto 666
-       ENDIF
-
-ccc       IF(abs(XF-XF_OLD)/XF.gt.0.01) goto 888
-       IF(abs(FFF-FFF_OLD)/FFF.gt.0.03) goto 888
-ccc    print *,'xxxxxxxx 3d Integration xxxxxxxxxx'
- 777   CONTINUE
- 666   NCALL=NCALL*2.
-       NDIMUSER=NDIMUSER_SAVE
-       NDIMUSER_EFF=NDIMUSER_EFF_SAVE
-       IF(NDIMUSER.eq.2    ) goto 999
-       IF(NDIMUSER_EFF.eq.2) NCALL=NCALL/2.
-
-       IF(FFF.lt.CS_MIN) THEN
-          FFF=1.E-20
-          GOTO 999
-       ENDIF
-
-
-       FFF=FUNC_INT(IPRINT)
- 999   continue
-  
-c      print *,'IPRINT=',IPRINT
-       IF(IPRINT.ge.3) then
-         NPROC_MAX_S=NPROC_MAX
-         NPROC_MIN_S=NPROC_MIN
-         SUMM=0.
-         
-         
-         DO I =NPROC_MIN_S,NPROC_MAX_S,NPROC_STEP
-           if(SUPPEXP.ge.SUPPEXPMAX.and.I.gt.26) GOTO 444
-           NPROC_MIN=I
-           NPROC_MAX=I
-           FFF_TMP=FUNC_INT(-1)
-           IF(FFF_TMP/FFF.gt.0.01) THEN
-             print '(I6,A4,F6.2,A2,4A8)',
-     &       I,'  ',FFF_TMP/FFF*100,' %',
-     &       (PINF(I,J),J=1,4)
-             SUMM=SUMM+FFF_TMP/FFF
-           ENDIF
-         ENDDO
- 444     continue	 
-
-         NPROC_MAX=NPROC_MAX_S
-         NPROC_MIN=NPROC_MIN_S
-       endif
-
-      
- 
- 555   continue
-       if(iprint.gt.1) then
-       print *,'===========FINAL======='
-       print *, 'freez out temp=',1d0/XF
-       print *, 'n steps       =',NST
-       print *, 'CS (fb)       =',FFF*1000d0
-       print *, 'OMEGA H^2     =',OMEGA(FFF)
-       print *,'======================='
-       endif
-
-       OMGH2 =OMEGA(FFF)
-       SIGMA =FFF
-       XFREEZ=XF
-       NSTEPS =NST
-
-       NCALL=NCALL_SAV
-      
-cccccccccccccccccccccccccccccccccccccccccccc
- 111   continue
-       NDIMUSER_SAVE=NDIMUSER
-       AS_MAX_SAVE  =AS_MAX
-       NDIMUSER=1
-       NDIMUSER_EFF=1
-
-       
-       VVV=1.E-03
-       AS_MAX=2.*sqrt(1.+(VVV/2.)**2)  
-       CONV1 =  2.998E+10  ! speed of light cm/sec
-       CONV2 =  1.000E-36  ! 1pb ==> cm^2
-
-       CS_V  =  FUNC_INT(IPRINT)
-       FFF_V =  CS_V*VVV*CONV1*CONV2
-
-       NDIMUSER=NDIMUSER_SAVE
-       AS_MAX=AS_MAX_SAVE
-       
-
-cccccccccccccccccccccccccccccccccccccccccccc       
-
-      RETURN
-      END
diff -rupN darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/makefile.in darksusy-5.1.3/contrib/isajet781-for-darksusy/makefile.in
--- darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/makefile.in	2011-11-03 14:34:52.000000000 +0000
+++ darksusy-5.1.3/contrib/isajet781-for-darksusy/makefile.in	2016-02-16 15:23:54.953099204 +0000
@@ -6,9 +6,6 @@
 FF=@F77@
 FOPT=@FOPT@
 
-DS_ROOT=../..
-LIB=$(DS_ROOT)/lib
-
 ########################################################
 ### READ THROUGH AND CHANGE THE DEFAULT VALUES BELOW ###
 ### BEFORE COMPILING.                                ###
@@ -20,21 +17,24 @@ LIB=$(DS_ROOT)/lib
 # to libisajet.a.
 # For compatibility with gfortran, aldata.o _is_ included here (after 'BLOCK DATA' has been changed to 'SUBROUTINE').
 
-OBJ = aldata.o alqcd.o amass.o amgmw.o ayukdiag.o b0func.o bases.o besk1.o bhinit.o bhplot.o bhrset.o bhsave.o bi.o bk2mvsm.o boostx.o brems.o bschck.o bsdate.o bsdims.o bsetgu.o bsetgv.o bsggut.o bsgrid.o bsinfo.o bsinit.o bsintg.o bslist.o bsordr.o bsparm.o bsprnt.o bsread.o bstcnv.o bstime.o bsutim.o bswrit.o bufin.o bufout.o c0.o cbk2mvsm.o ccon.o cdagger.o charge.o chargino.o chdec.o chint.o ci.o cmatmul.o cmd.o cmodsq.o colr12.o colr13.o colr22.o con.o coup1x.o coup2x.o coup3x.o coup4x.o cputim.o cre.o crge215.o crge601.o crkstp.o csfmul.o csmrgedr.o cteq5l.o ctq5pdf.o ctrace.o ctxc2i.o ctxi2c.o ctxin.o ctxout.o d0.o dadmul.o dagger.o dblpcm.o dblvec.o dboost.o dcabs1.o ddilog.o decay.o decjet.o decoutcoup.o decps1.o decps2.o decrun.o decss3.o dectau.o decva.o dhfill.o dhinit.o dhplot.o di.o diagsqm.o dincgm.o disnan.o dlabad.o dladiv.o dlaisnan.o dlamc1.o dlamc2.o dlamc3.o dlamc4.o dlamc5.o dlamch.o dlapy2.o dlapy3.o dmatmul.o domssm.o downmhcond.o downmhighmh.o downmhighmz.o downmscond.o downsqm.o dre.o drge215.o drge601.o drkstp.o drllyn.o drn.o drnset.o drotsq.o drotsqback.o dscal.o dsmma.o dsmrgedr.o dtrace.o dtrint.o dzasum.o dznrm2.o eaixxx.o eaoxxx.o ebeam.o edit.o eebeg.o eemax.o ei.o eigsys.o eisrs1.o elctrn.o epf.o estruc.o evol01.o evol02.o evol03.o evol05.o evol06.o evol07.o evol11.o evolms.o evolve.o fa12.o fa12_integr.o fbrbm.o fes.o flavor.o fntg.o fortop.o frgjet.o frgmnt.o fsixxx.o fsoxxx.o func.o func_int.o funs.o fvixxx.o fvoxxx.o gamma.o gammac1.o gammac2.o gammahp.o gammasm.o gammawb1.o gammawb2.o gamtot.o gbeam.o ges.o getpas.o getpt.o gettot.o ggggxx.o gggxxx.o gluneno.o gout601.o gstruc.o hdcyad.o hdcysy.o heavyx.o hermtest.o hevolv.o higgs.o highin.o hioxxx.o hsssxx.o hssxxx.o hvsxxx.o hvvxxx.o idamax.o idanti.o idgen.o ieeeck.o iframs.o ilaenv.o ilazlc.o inisap.o iosxxx.o iovxxx.o ipartns.o ipjset.o iprtns.o irmov0.o isaamu.o isabeg.o isabmm.o isabsg.o isachp.o isaend.o isaevt.o isahep.o isaini.o isajet.o isalha.o isalhd.o isalhe.o isared.o isares.o isasrt.o isawbg.o isawev.o isawig.o isawnd.o ispjet.o istrad.o iswdky.o itrans.o ixxxxx.o j3xxxx.o jeexxx.o jetgen.o jgggxx.o jggxxx.o jioxxx.o jssxxx.o jtioxx.o jvssxx.o jvsxxx.o jvvxxx.o jw3wxx.o jwwwxx.o kkgf1.o kkgf2.o kkgf3.o kmin.o label.o lboost.o logerr.o logic.o logmgm.o logmgy.o logmij.o logp.o logphi.o logphw.o logpt.o logqm.o logqt.o logthw.o logx.o logxw.o logyth.o logyw.o lsame.o lstsq.o mass.o masssqm.o mat2vec.o mbias.o mbset.o mginit.o mmamsb.o modsq.o mom2cx.o momntx.o movlev.o mprod2.o mprod2x.o mprod3.o mprod3x.o mprod4x.o mprod5x.o muljet.o nogood.o omega.o ordecr.o order.o orth.o outcoup.o oxxxxx.o pdgid.o piblbl.o piblbr.o pibrbr.o pielel.o pierer.o pillll.o pilllr.o pilrlr.o pinene.o pitltl.o pitltr.o pitrtr.o prtevt.o prtlim.o prtlst.o ptfun.o qcdini.o qcdint.o qcdinz.o qcdjet.o qcdt.o qcdz.o qfunc.o ranf.o ranfgt.o ranfmt.o ranfst.o ranlux.o rdbeg.o rdtape.o readin.o rejfrg.o rejjet.o remsf.o rend.o rescal.o reset.o rge157.o rgeflav.o rgens.o rgeread.o rkstp.o rotate.o rotate215.o rotatesm.o rotback.o rotback215.o rotbacksm.o rotsq.o rotsqback.o rotxxx.o rpdecy.o rpinf1.o rpinf2.o rpint1.o rpint2.o rpint3.o rpmain.o rpmoda.o rpnorm.o rprate.o rprtch.o setcon.o setdky.o seth.o sethss.o setkkg.o setnxt.o settyp.o setw.o sfmul.o shcler.o shfill.o shinit.o shplot.o shrset.o shupdt.o sig0l.o sig0r.o sig0s.o sigdy.o sigdy2.o sigee.o sigfil.o siggam.o sigh.o sigh2.o sigh3.o sighss.o sigint.o sigkkg.o sigpl.o sigpr.o sigps.o sigqcd.o sigsse.o sigssl.o sigssy.o sigssz.o sigtc.o sigtc2.o sigtc3.o sigwh.o sigwhs.o sigww.o sigww2.o smszg.o sorttf.o sortth.o sortzg.o spchck.o sphist.o spinfo.o spline.o sprgen.o spring.o sqdiag.o sqrlam.o sqsix.o ssa0.o ssalfs.o ssb0.o ssb00.o ssb1.o ssb1f.o ssbt20.o ssbt22.o ssc0.o ssd0.o ssd27.o ssdhll.o ssdint.o ssdlam.o ssf.o ssf0.o ssfel.o ssg.o ssglbf.o ssgst.o ssgt.o ssgwq1.o ssgwq2.o ssgwt1.o ssgwt2.o ssgwt3.o ssgwt4.o ssgwt5.o ssgwt6.o ssgwt7.o ssgwt8.o ssgx1.o ssgx10.o ssgx11.o ssgx2.o ssgx3.o ssgx4.o ssgx5.o ssgx6.o ssgx7.o ssgx8.o ssgx9.o ssgzg1.o ssgzg2.o ssgzg3.o ssgzt.o ssh.o ssh0.o sshcc.o sshff.o sshff1.o sshgl.o sshgm.o sshgm1.o sshhx.o sshibf.o sshnn.o sshsf.o sshww.o sshww1.o sshww2.o ssl1st.o sslpbf.o sslrt1.o ssm1lp.o ssmass.o ssme3.o ssmhc.o ssmhn.o ssmqcd.o ssmssm.o ssn1st.o ssnorm.o sspole.o ssqkbf.o ssrsgb.o ssrsgl.o ssrsgt.o sssave.o sssnws.o ssssxx.o ssstbf.o sssvme.o sssxxx.o sstest.o sstpbf.o sswibf.o sswwf1.o sswz2p.o sswz3p.o sswzbf.o sswzf1.o sswzf2.o sswzf3.o sswzf4.o sswzf5.o sswzf6.o sswzf7.o ssxint.o ssxlam.o sszhx.o sszibf.o sszwf1.o sszzf1.o sszzf2.o sszzf3.o sszzf4.o sszzf5.o sszzg1.o sszzg2.o sszzg3.o sszzg4.o st1cneu.o st3int.o st3mat.o stbwz1.o stradd.o strotate.o strotback.o struc.o strucw.o sualfe.o sualfs.o sug2bsg.o sugeff.o sugefffl.o sugfrz.o sugmas.o sugra.o sugrge.o surg06.o surg26.o sxxxxx.o symmtest.o szjj1.o szjj2.o szjj3.o szjj4.o szjj5.o szjj6.o szjj7.o tactiv.o tcsfmul.o thetaxy.o timer.o tql2.o tqleig.o tr3x3.o trace.o trdiag.o tred2.o triint.o tsfmul.o twojet.o twokin.o uoutcoup.o upmhcond.o upmhcond2.o upmzmhigh.o upmzmhigh2.o upsqm.o usmma.o vec2mat.o vgen.o visaje.o vssxxx.o vvssxx.o vvsxxx.o vvvxxx.o vxxxxx.o w3w3xx.o wgens.o whiggs.o wilson.o wpair.o wwkin.o wwss.o wwst.o wwtt.o wwwwxx.o wzss.o wzst.o wzsu.o wztu.o xerbla.o xhchck.o xhfill.o xhinit.o xhordr.o xhplot.o xhrnge.o xhscle.o xkaim.o xkare.o xwwww.o xwwzz.o xzzww.o xzzzz.o ygenj.o yukdiag.o zaxpy.o zcopy.o zdotc.o zdotu.o zdscal.o zerol.o zgebak.o zgebal.o zgeev.o zgehd2.o zgehrd.o zgemm.o zgemv.o zgerc.o zhseqr.o zjj.o zjj0.o zjj1.o zjj2.o zjj3.o zjj4.o zjj5.o zjj6.o zjj7.o zlacgv.o zlacpy.o zladiv.o zlahqr.o zlahr2.o zlange.o zlaqr0.o zlaqr1.o zlaqr2.o zlaqr3.o zlaqr4.o zlaqr5.o zlarf.o zlarfb.o zlarfg.o zlarft.o zlartg.o zlascl.o zlaset.o zlassq.o zlatrs.o zrot.o zscal.o zswap.o ztrevc.o ztrexc.o ztrmm.o ztrmv.o ztrsv.o zung2r.o zunghr.o zungqr.o zunm2r.o zunmhr.o zunmqr.o zzall.o zzstar.o
+OBJ = aldata.o alqcd.o amass.o amgmw.o ayukdiag.o b0func.o bases.o besk1.o bhinit.o bhplot.o bhrset.o bhsave.o bi.o bk2mvsm.o boostx.o brems.o bschck.o bsdate.o bsdims.o bsetgu.o bsetgv.o bsggut.o bsgrid.o bsinfo.o bsinit.o bsintg.o bslist.o bsordr.o bsparm.o bsprnt.o bsread.o bstcnv.o bstime.o bsutim.o bswrit.o bufin.o bufout.o c0.o cbk2mvsm.o ccon.o cdagger.o charge.o chargino.o chdec.o chint.o ci.o cmatmul.o cmd.o cmodsq.o colr12.o colr13.o colr22.o con.o coup1x.o coup2x.o coup3x.o coup4x.o cputim.o cre.o crge215.o crge601.o crkstp.o csfmul.o csmrgedr.o cteq5l.o ctq5pdf.o ctrace.o ctxc2i.o ctxi2c.o ctxin.o ctxout.o d0.o dadmul.o dagger.o dblpcm.o dblvec.o dboost.o dcabs1.o ddilog.o decay.o decjet.o decoutcoup.o decps1.o decps2.o decrun.o decss3.o dectau.o decva.o dhfill.o dhinit.o dhplot.o di.o diagsqm.o dincgm.o disnan.o dlabad.o dladiv.o dlaisnan.o dlamc1.o dlamc2.o dlamc3.o dlamc4.o dlamc5.o dlamch.o dlapy2.o dlapy3.o dmatmul.o domssm.o downmhcond.o downmhighmh.o downmhighmz.o downmscond.o downsqm.o dre.o drge215.o drge601.o drkstp.o drllyn.o drn.o drnset.o drotsq.o drotsqback.o dscal.o dsmma.o dsmrgedr.o dtrace.o dtrint.o dzasum.o dznrm2.o eaixxx.o eaoxxx.o ebeam.o edit.o eebeg.o eemax.o ei.o eigsys.o eisrs1.o elctrn.o epf.o estruc.o evol01.o evol02.o evol03.o evol05.o evol06.o evol07.o evol11.o evolms.o evolve.o fa12_integr.o fbrbm.o fes.o flavor.o fntg.o fortop.o frgjet.o frgmnt.o fsixxx.o fsoxxx.o funs.o fvixxx.o fvoxxx.o gamma.o gammac1.o gammac2.o gammahp.o gammasm.o gammawb1.o gammawb2.o gamtot.o gbeam.o ges.o getpas.o getpt.o gettot.o ggggxx.o gggxxx.o gluneno.o gout601.o gstruc.o hdcyad.o hdcysy.o heavyx.o hermtest.o hevolv.o higgs.o highin.o hioxxx.o hsssxx.o hssxxx.o hvsxxx.o hvvxxx.o idamax.o idanti.o idgen.o ieeeck.o iframs.o ilaenv.o ilazlc.o inisap.o iosxxx.o iovxxx.o ipartns.o ipjset.o iprtns.o irmov0.o isaamu.o isabeg.o isabmm.o isabsg.o isachp.o isaend.o isaevt.o isahep.o isaini.o isajet.o isalha.o isalhd.o isalhe.o isares.o isasrt.o isawbg.o isawev.o isawig.o isawnd.o ispjet.o istrad.o iswdky.o itrans.o ixxxxx.o j3xxxx.o jeexxx.o jetgen.o jgggxx.o jggxxx.o jioxxx.o jssxxx.o jtioxx.o jvssxx.o jvsxxx.o jvvxxx.o jw3wxx.o jwwwxx.o kkgf1.o kkgf2.o kkgf3.o kmin.o label.o lboost.o logerr.o logic.o logmgm.o logmgy.o logmij.o logp.o logphi.o logphw.o logpt.o logqm.o logqt.o logthw.o logx.o logxw.o logyth.o logyw.o lsame.o lstsq.o mass.o masssqm.o mat2vec.o mbias.o mbset.o mginit.o mmamsb.o modsq.o mom2cx.o momntx.o movlev.o mprod2.o mprod2x.o mprod3.o mprod3x.o mprod4x.o mprod5x.o muljet.o nogood.o omega.o ordecr.o order.o orth.o outcoup.o oxxxxx.o pdgid.o piblbl.o piblbr.o pibrbr.o pielel.o pierer.o pillll.o pilllr.o pilrlr.o pinene.o pitltl.o pitltr.o pitrtr.o prtevt.o prtlim.o prtlst.o ptfun.o qcdini.o qcdint.o qcdinz.o qcdjet.o qcdt.o qcdz.o qfunc.o ranf.o ranfgt.o ranfmt.o ranfst.o ranlux.o rdbeg.o rdtape.o readin.o rejfrg.o rejjet.o remsf.o rend.o rescal.o reset.o rge157.o rgeflav.o rgens.o rgeread.o rkstp.o rotate.o rotate215.o rotatesm.o rotback.o rotback215.o rotbacksm.o rotsq.o rotsqback.o rotxxx.o rpdecy.o rpinf1.o rpinf2.o rpint1.o rpint2.o rpint3.o rpmain.o rpmoda.o rpnorm.o rprate.o rprtch.o setcon.o setdky.o seth.o sethss.o setkkg.o setnxt.o settyp.o setw.o sfmul.o shcler.o shfill.o shinit.o shplot.o shrset.o shupdt.o sig0l.o sig0r.o sig0s.o sigdy.o sigdy2.o sigee.o sigfil.o siggam.o sigh.o sigh2.o sigh3.o sighss.o sigint.o sigkkg.o sigpl.o sigpr.o sigps.o sigqcd.o sigsse.o sigssl.o sigssy.o sigssz.o sigtc.o sigtc2.o sigtc3.o sigwh.o sigwhs.o sigww.o sigww2.o smszg.o sorttf.o sortth.o sortzg.o spchck.o sphist.o spinfo.o spline.o sprgen.o spring.o sqdiag.o sqrlam.o sqsix.o ssa0.o ssalfs.o ssb0.o ssb00.o ssb1.o ssb1f.o ssbt20.o ssbt22.o ssc0.o ssd0.o ssd27.o ssdhll.o ssdint.o ssdlam.o ssf.o ssf0.o ssfel.o ssg.o ssglbf.o ssgst.o ssgt.o ssgwq1.o ssgwq2.o ssgwt1.o ssgwt2.o ssgwt3.o ssgwt4.o ssgwt5.o ssgwt6.o ssgwt7.o ssgwt8.o ssgx1.o ssgx10.o ssgx11.o ssgx2.o ssgx3.o ssgx4.o ssgx5.o ssgx6.o ssgx7.o ssgx8.o ssgx9.o ssgzg1.o ssgzg2.o ssgzg3.o ssgzt.o ssh.o ssh0.o sshcc.o sshff.o sshff1.o sshgl.o sshgm.o sshgm1.o sshhx.o sshibf.o sshnn.o sshsf.o sshww.o sshww1.o sshww2.o ssid.o ssl1st.o sslpbf.o sslrt1.o ssm1lp.o ssmass.o ssme3.o ssmhc.o ssmhn.o ssmqcd.o ssmssm.o ssn1st.o ssnorm.o sspole.o ssqkbf.o ssrsgb.o ssrsgl.o ssrsgt.o sssave.o sssnws.o ssssxx.o ssstbf.o sssvme.o sssxxx.o sstest.o sstpbf.o sswibf.o sswwf1.o sswz2p.o sswz3p.o sswzbf.o sswzf1.o sswzf2.o sswzf3.o sswzf4.o sswzf5.o sswzf6.o sswzf7.o ssxint.o ssxlam.o sszhx.o sszibf.o sszwf1.o sszzf1.o sszzf2.o sszzf3.o sszzf4.o sszzf5.o sszzg1.o sszzg2.o sszzg3.o sszzg4.o st1cneu.o st3int.o st3mat.o stbwz1.o stradd.o strotate.o strotback.o struc.o strucw.o sualfe.o sualfs.o sug2bsg.o sugeff.o sugefffl.o sugfrz.o sugmas.o sugra.o sugrge.o surg06.o surg26.o sxxxxx.o symmtest.o szjj1.o szjj2.o szjj3.o szjj4.o szjj5.o szjj6.o szjj7.o tactiv.o tcsfmul.o thetaxy.o timer.o tql2.o tqleig.o tr3x3.o trace.o trdiag.o tred2.o triint.o tsfmul.o twojet.o twokin.o uoutcoup.o upmhcond.o upmhcond2.o upmzmhigh.o upmzmhigh2.o upsqm.o usmma.o vec2mat.o vgen.o visaje.o vssxxx.o vvssxx.o vvsxxx.o vvvxxx.o vxxxxx.o w3w3xx.o wgens.o whiggs.o wilson.o wpair.o wwkin.o wwss.o wwst.o wwtt.o wwwwxx.o wzss.o wzst.o wzsu.o wztu.o xerbla.o xhchck.o xhfill.o xhinit.o xhordr.o xhplot.o xhrnge.o xhscle.o xkaim.o xkare.o xwwww.o xwwzz.o xzzww.o xzzzz.o ygenj.o yukdiag.o zaxpy.o zcopy.o zdotc.o zdotu.o zdscal.o zerol.o zgebak.o zgebal.o zgeev.o zgehd2.o zgehrd.o zgemm.o zgemv.o zgerc.o zhseqr.o zjj.o zjj0.o zjj1.o zjj2.o zjj3.o zjj4.o zjj5.o zjj6.o zjj7.o zlacgv.o zlacpy.o zladiv.o zlahqr.o zlahr2.o zlange.o zlaqr0.o zlaqr1.o zlaqr2.o zlaqr3.o zlaqr4.o zlaqr5.o zlarf.o zlarfb.o zlarfg.o zlarft.o zlartg.o zlascl.o zlaset.o zlassq.o zlatrs.o zrot.o zscal.o zswap.o ztrevc.o ztrexc.o ztrmm.o ztrmv.o ztrsv.o zung2r.o zunghr.o zungqr.o zunm2r.o zunmhr.o zunmqr.o zzall.o zzstar.o
 
 #OBJ2 = aldata.o
 
-vpath %.a $(LIB)
+vpath %.a $(DS_LIB)
 
 #all : libisajet.a aldata.o
-all : libisajet.a
+all : libisajet.a libisajet.so
 
 #aldata.o: aldata.f
-#	$(FF) $(FOPT) -c -o $(LIB)/aldata.o aldata.f
+#	$(FF) $(FOPT) -c -o $(DS_LIB)/aldata.o aldata.f
 
 libisajet.a: $(OBJ)
-	ar r $(LIB)/libisajet.a $(OBJ)
-	ranlib $(LIB)/libisajet.a
+	ar r $(DS_LIB)/libisajet.a $(OBJ)
+	ranlib $(DS_LIB)/libisajet.a
+
+libisajet.so: $(OBJ)
+	$(FF) $(FOPT) -shared -o $(DS_LIB)/libisajet.so $(OBJ)
 
 clean:
 	rm -f *.o
diff -rupN darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/ssid.f darksusy-5.1.3/contrib/isajet781-for-darksusy/ssid.f
--- darksusy-5.1.3.pristine/contrib/isajet781-for-darksusy/ssid.f	1970-01-01 01:00:00.000000000 +0100
+++ darksusy-5.1.3/contrib/isajet781-for-darksusy/ssid.f	2016-02-02 18:00:59.475882565 +0000
@@ -0,0 +1,80 @@
+      CHARACTER*5 FUNCTION SSID(ID)
+C-----------------------------------------------------------------------
+C
+C     Return character name for ID, assuming the default IDENT codes
+C     are used in /SSTYPE/.
+C
+C     Extracted by hand from ISAJET 1.8.5's isajet.car
+C     Pat Scott Feb 2 2016
+C
+C-----------------------------------------------------------------------
+      IMPLICIT NONE
+
+      COMMON/SSLUN/LOUT,LHEOUT
+      INTEGER LOUT,LHEOUT
+      SAVE /SSLUN/
+
+      CHARACTER*5 LABEL(-120:120)
+      SAVE LABEL
+      INTEGER ID,J
+C
+      DATA LABEL(0)/'     '/
+C
+      DATA (LABEL(J),J=1,10)
+     $/'UP   ','DN   ','ST   ','CH   ','BT   ','TP   '
+     $,'ERROR','ERROR','GL   ','GM   '/
+      DATA (LABEL(J),J=-1,-10,-1)
+     $/'UB   ','DB   ','SB   ','CB   ','BB   ','TB   '
+     $,'ERROR','ERROR','ERROR','ERROR'/
+C
+      DATA (LABEL(J),J=11,20)
+     $/'NUE  ','E-   ','NUM  ','MU-  ','NUT  ','TAU- '
+     $,'ERROR','ERROR','ERROR','ERROR'/
+      DATA (LABEL(J),J=-11,-20,-1)
+     $/'ANUE ','E+   ','ANUM ','MU+  ','ANUT ','TAU+ '
+     $,'ERROR','ERROR','ERROR','ERROR'/
+C
+      DATA (LABEL(J),J=21,30)
+     $/'UPL  ','DNL  ','STL  ','CHL  ','BT1  ','TP1  '
+     $,'ERROR','ERROR','GLSS ','Z1SS '/
+      DATA (LABEL(J),J=-21,-30,-1)
+     $/'UBL  ','DBL  ','SBL  ','CBL  ','BB1  ','TB1  '
+     $,'ERROR','ERROR','ERROR','ERROR'/
+C
+      DATA (LABEL(J),J=31,40)
+     $/'NUEL ','EL-  ','NUML ','MUL- ','NUTL ','TAU1-'
+     $,'ERROR','ERROR','W1SS+','Z2SS '/
+      DATA (LABEL(J),J=-31,-40,-1)
+     $/'ANUEL','EL+  ','ANUML','MUL+ ','ANUTL','TAU1+'
+     $,'ERROR','ERROR','W1SS-','ERROR'/
+C
+      DATA (LABEL(J),J=41,50)
+     $/'UPR  ','DNR  ','STR  ','CHR  ','BT2  ','TP2  '
+     $,'ERROR','ERROR','W2SS+','Z3SS '/
+      DATA (LABEL(J),J=-41,-50,-1)
+     $/'UBR  ','DBR  ','SBR  ','CBR  ','BB2  ','TB2  '
+     $,'ERROR','ERROR','W2SS-','ERROR'/
+C
+      DATA (LABEL(J),J=51,60)
+     $/'NUER ','ER-  ','NUMR ','MUR- ','NUTR ','TAU2-'
+     $,'ERROR','ERROR','ERROR','Z4SS '/
+      DATA (LABEL(J),J=-51,-60,-1)
+     $/'ANUEL','ER+  ','ANUMR','MUR+ ','ANUTR','TAU2+'
+     $,'ERROR','ERROR','ERROR','ERROR'/
+C
+      DATA (LABEL(J),J=82,86)
+     $/'HL0  ','HH0  ','HA0  ','ERROR','H+   '/
+      DATA LABEL(-86)/'H-   '/
+C
+      DATA LABEL(80)/'W+   '/,LABEL(-80)/'W-   '/,LABEL(90)/'Z0   '/
+      DATA LABEL(91)/'GVSS '/
+      DATA LABEL(110)/'PI0  '/
+      DATA LABEL(120)/'PI+  '/,LABEL(-120)/'PI-  '/
+C
+      IF(IABS(ID).GT.120) THEN
+        WRITE(LOUT,*) 'SSID: ID = ',ID
+        STOP99
+      ENDIF
+      SSID=LABEL(ID)
+      RETURN
+      END
diff -rupN darksusy-5.1.3.pristine/contrib/TSPACK/makefile.in darksusy-5.1.3/contrib/TSPACK/makefile.in
--- darksusy-5.1.3.pristine/contrib/TSPACK/makefile.in	2013-02-10 06:43:34.000000000 +0000
+++ darksusy-5.1.3/contrib/TSPACK/makefile.in	2016-02-02 12:05:04.402044521 +0000
@@ -9,8 +9,7 @@ FOPT=@FOPT@
 # Dependencies and libraries
 DINC=../../include
 LIB=../../lib
-
-INC_DEP = 
+BUILD=../../build/
 
 vpath %.h $(DINC)
 
@@ -19,12 +18,11 @@ tspack = ENDSLP.f SIGS.f SNHCSH.f STORE.
 
 all: tspack
 
-tspack : $(tspack) makefile
+tspack : 
 	cat $(tspack) > tspack.f
 	$(FF) $(FOPT) -c -I$(DINC) -o tspack.o tspack.f
+	mv tspack.o $(BUILD)/
 	rm tspack.f
-	ar rv $(LIB)/libdarksusy.a tspack.o
-	ranlib $(LIB)/libdarksusy.a
 
 clean:
 	rm -f tspack.f *.o
diff -rupN darksusy-5.1.3.pristine/include/dswacom.h darksusy-5.1.3/include/dswacom.h
--- darksusy-5.1.3.pristine/include/dswacom.h	2015-12-20 21:43:06.000000000 +0000
+++ darksusy-5.1.3/include/dswacom.h	2016-02-05 14:57:05.686980691 +0000
@@ -18,30 +18,26 @@ c...to 52.
       integer wamax,walast(2),wanm
       parameter(wamax=6) ! number of tables to load simultaneously
       parameter(wanm=28) ! number of masses for tabulation
-      real*8 lb,ub,mi,thindex,zindex,dth,dz
-      real phiint,phidiff,phimixed
-      integer milow,thn,zn,yload
+      real*8 lb(14),ub(14),mi(wanm),thindex(-1:90,2),
+     &  zindex(-1:50,2),dth(-1:90),dz(-1:50)
+      real phiint(-1:90,0:50,wanm,13,2,wamax),
+     &  phidiff(-1:90,-1:50,wanm,13,2,wamax),
+     &  phimixed(-1:90,-1:50,wanm,13,2,wamax)
+      integer milow(14),thn,zn,yload(2,26)
       integer kind2ki(3)
       character*128 wadir
       character waftype
       character*40 wabase
-      common/wasim/lb(14),ub(14),mi(wanm),thindex(-1:90,2),
-     &  zindex(-1:50,2),dth(-1:90),dz(-1:50),
-     &  yload(2,26),walast,
-     &  milow(14),thn,zn,kind2ki,
+      common/wasim/lb,ub,mi,thindex,zindex,dth,dz,
+     &  yload,walast,
+     &  milow,thn,zn,kind2ki,
      &  wadir,waftype,wabase
-      common/wasim2/ phiint(-1:90,0:50,wanm,13,2,wamax),
-     &  phidiff(-1:90,-1:50,wanm,13,2,wamax),
-     &  phimixed(-1:90,-1:50,wanm,13,2,wamax)
+      common/wasim2/ phiint, phidiff, phimixed
 
 c...wagen - general stuff
       integer ch2chi(29),chi2chii(14),chii2chi(13),chi2ch(14)
       common /wagen/ch2chi,chi2chii,chii2chi,chi2ch
 
-c...wainfo - tag etc.
-      integer waerr,waistat
-      common/wainfo/waerr,waistat
-
 c...waopt - options
       real*8 wasbrmin
       common/waopt/wasbrmin
@@ -58,8 +54,7 @@ c...wabranch - annihilation branching ra
      &  wasv,wasigsip,wasigsdp,dswasetupcalled
 
 c save common block
-      save /wasim/,/wainfo/,/wasim2/,/wasim3/,/wagen/,
-     &  /wabranch/,/waopt/
+      save /wasim/,/wasim2/,/wasim3/,/wagen/,/wabranch/,/waopt/
 ***                                                                 ***
 ************************** end of muoncom.h ***************************
 
diff -rupN darksusy-5.1.3.pristine/makefile.in darksusy-5.1.3/makefile.in
--- darksusy-5.1.3.pristine/makefile.in	2015-04-07 10:23:05.000000000 +0100
+++ darksusy-5.1.3/makefile.in	2016-02-16 15:33:54.337088470 +0000
@@ -82,7 +82,11 @@ config_paths config :
 
 darksusy_lib dslib : tspack
 	mkdir -p lib
-	cd $(DS_ROOT)/src; make all
+	cd $(DS_ROOT)/src; make libdarksusy.a
+
+darksusy_lib_shared dslib_shared : tspack libisajet_shared feynhiggs_shared higgsbounds_shared
+	mkdir -p lib
+	cd $(DS_ROOT)/src; make DS_LIB="$(DS_INSTALL)/lib" libdarksusy.so
 
 install : install_builds install_tables
 
@@ -139,15 +143,27 @@ install_tables :
 	cd $(DS_ROOT)/share/DarkSUSY; make all
 
 libisajet :
-	cd $(ISAJETDIR); make
+	cd $(ISAJETDIR); make libisajet.a
+
+libisajet_shared :
+	cd $(ISAJETDIR); make DS_LIB="$(DS_INSTALL)/lib" libisajet.so
 
 tspack:
 	cd $(TSPACKDIR); make
 
 feynhiggs :
 	cd $(FEYNHIGGSDIR); \
-	make lib ; \
+	make FC="$(FF)" FFLAGS="$(FOPT)" CFLAGS="-fPIC" lib ; \
 	cp -p build/libFH.a $(DS_ROOT)/lib/ ; \
+	make copy_feynhiggs_headers
+
+feynhiggs_shared :
+	cd $(FEYNHIGGSDIR); \
+	make FC="$(FF)" FFLAGS="$(FOPT)" CFLAGS="-fPIC" DS_LIB="$(DS_INSTALL)/lib" lib_shared
+	make copy_feynhiggs_headers
+
+copy_feynhiggs_headers :
+	cd $(FEYNHIGGSDIR); \
 	cp -p build/include/FHCouplings.h $(DS_ROOT)/include/ ;  \
 	cp -p build/include/SLHA.h $(DS_ROOT)/include/  ; \
 	cp -p build/include/SLHADefs.h $(DS_ROOT)/include/  ; \
@@ -158,6 +174,10 @@ higgsbounds :
 	make -f makefile_darksusy libHB ; \
 	cp -p libHB.a $(DS_ROOT)/lib/
 
+higgsbounds_shared :
+	cd $(HBDIR); \
+	make -f makefile_darksusy DS_LIB="$(DS_INSTALL)/lib" libHB_shared ; \
+
 # SLHA is currently not built, as feynhiggs includes slhalib
 slha :
 	cd $(SLHADIR); \
@@ -184,7 +204,7 @@ clean :
 	cd $(DS_ROOT)/contrib/galprop/v50p; $(MAKE) clean
 	cd $(FEYNHIGGSDIR); $(MAKE) clean ; rm -fr ds
 	cd $(SLHADIR); $(MAKE) clean ; rm -fr ds
-	cd $(HBDIR); $(MAKE) -f makefile_darksusy -i veryclean; $(MAKE) -f makefile_darksusy -i hyperclean
+	cd $(HBDIR); $(MAKE) -f makefile_darksusy -i clean
 	cd $(TSPACKDIR); $(MAKE) clean
 
 
@@ -198,6 +218,11 @@ rmmore:
 	rm -f $(DS_ROOT)/lib/libFH.a
 	rm -f $(DS_ROOT)/lib/libSLHA.a
 	rm -f $(DS_ROOT)/lib/libHB.a
+	rm -f $(DS_ROOT)/lib/libdarksusy.so
+	rm -f $(DS_ROOT)/lib/libisajet.so
+	rm -f $(DS_ROOT)/lib/libFH.so
+	rm -f $(DS_ROOT)/lib/libSLHA.so
+	rm -f $(DS_ROOT)/lib/libHB.so
 	rm -f $(DS_ROOT)/lib/aldata.o
 	rm -f $(DS_ROOT)/lib/libcfitsio.a
 	rm -f $(DS_ROOT)/share/DarkSUSY/ascii2bin
@@ -229,6 +254,7 @@ rmmore:
 # If it is, we know that DS_INSTALL must point to DS_ROOT.
 uninstall:
 	rm -f $(DS_INSTALL)/lib/libdarksusy.a
+	rm -f $(DS_INSTALL)/lib/libdarksusy.so
 	rm -f $(DS_INSTALL)/lib/aldata.o
 	if [ ! -f $(DS_INSTALL)/makefile.in ] ; then \
 		echo 'The install directory is different from DS_ROOT' ; \
diff -rupN darksusy-5.1.3.pristine/src/ini/dsdirname.c.in darksusy-5.1.3/src/ini/dsdirname.c.in
--- darksusy-5.1.3.pristine/src/ini/dsdirname.c.in	2008-02-21 16:08:34.000000000 +0000
+++ darksusy-5.1.3/src/ini/dsdirname.c.in	1970-01-01 01:00:00.000000000 +0100
@@ -1,25 +0,0 @@
-/* #include "../../config.h" */
-#include <string.h>
-
-#define DSROOTNAME "@prefix@"
-
-void dsdirname(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSROOTNAME);
-  return;
-}
-
-void dsdirname_(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSROOTNAME);
-  return;
-}
-
-void dsdirname__(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSROOTNAME);
-  return;
-}
diff -rupN darksusy-5.1.3.pristine/src/ini/dssetdsinstall.f darksusy-5.1.3/src/ini/dssetdsinstall.f
--- darksusy-5.1.3.pristine/src/ini/dssetdsinstall.f	2011-11-04 23:48:05.000000000 +0000
+++ darksusy-5.1.3/src/ini/dssetdsinstall.f	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-      subroutine dssetdsinstall
-      implicit none
-      integer i
-      character*300 name
-      include 'dsdirver.h'
-      call dsdirname(name)
-      i=1
- 10   if (name(i:i).eq.'\000') goto 20
-      i=i+1
-      goto 10
- 20   i=i-1
-c      write (*,*) 'i=',i
-cccc      dsinstall=name(:i)//'/'
-      write (*,*) 'dssetdsinstall: cannot reset dsinstall'
-      stop
-c      write (*,*) dsinstall
-      end
diff -rupN darksusy-5.1.3.pristine/src/ini/dssetdsversion.f darksusy-5.1.3/src/ini/dssetdsversion.f
--- darksusy-5.1.3.pristine/src/ini/dssetdsversion.f	2008-02-21 16:08:34.000000000 +0000
+++ darksusy-5.1.3/src/ini/dssetdsversion.f	1970-01-01 01:00:00.000000000 +0100
@@ -1,15 +0,0 @@
-      subroutine dssetdsversion
-      implicit none
-      integer i
-      character*300 name
-      include 'dsdirver.h'
-      call dsvername(name)
-      i=1
- 10   if (name(i:i).eq.'\000') goto 20
-      i=i+1
-      goto 10
- 20   i=i-1
-c      write (*,*) 'i=',i
-      dsversion=name(:i)
-c      write (*,*) dsversion
-      end
diff -rupN darksusy-5.1.3.pristine/src/ini/dsvername.c.in darksusy-5.1.3/src/ini/dsvername.c.in
--- darksusy-5.1.3.pristine/src/ini/dsvername.c.in	2008-02-21 16:08:34.000000000 +0000
+++ darksusy-5.1.3/src/ini/dsvername.c.in	1970-01-01 01:00:00.000000000 +0100
@@ -1,25 +0,0 @@
-/* #include "../../config.h" */
-#include <string.h>
-
-#define DSVERNAME "@DSVERSION@@DSREV@"
-
-void dsvername(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSVERNAME);
-  return;
-}
-
-void dsvername_(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSVERNAME);
-  return;
-}
-
-void dsvername__(char*name)
-{
-  name[0]='\0';
-  strcpy(name,DSVERNAME);
-  return;
-}
diff -rupN darksusy-5.1.3.pristine/src/ini/makefile.in darksusy-5.1.3/src/ini/makefile.in
--- darksusy-5.1.3.pristine/src/ini/makefile.in	2011-11-04 23:48:05.000000000 +0000
+++ darksusy-5.1.3/src/ini/makefile.in	2016-02-02 12:48:22.605727992 +0000
@@ -22,7 +22,7 @@ dswacom.h
 vpath %.h $(DINC)
 
 SRC = dscval.f dsfval.f dsinit.f dsival.f dskillsp.f dslowcase.f \
-dslval.f dsreadnuclides.f dsreadpar.f dssetdsinstall.f dssetdsversion.f
+dslval.f dsreadnuclides.f dsreadpar.f
 
 OBJ = $(patsubst %.f,$(DOBJ)/%.o,$(SRC))
 
diff -rupN darksusy-5.1.3.pristine/src/makefile.in darksusy-5.1.3/src/makefile.in
--- darksusy-5.1.3.pristine/src/makefile.in	2015-04-07 10:23:05.000000000 +0100
+++ darksusy-5.1.3/src/makefile.in	2016-02-16 15:20:51.969102481 +0000
@@ -10,9 +10,11 @@
 #### DO NOT CHANGE ANYTHING BELOW THIS LINE ###
 ###############################################
 
+FF=@F77@
+FOPT=@FOPT@
+
 # Here we set where the library goes and where include files are.
 
-LIB=../lib
 INC=../include
 TSPACKDIR=@TSPACKDIR@
 BUILD=../build
@@ -32,18 +34,22 @@ all-local : make-lib
 make-lib :
 	cd ..; make dslib
 
-all : libdarksusy.a
+all : libdarksusy.a libdarksusy.so
 
 libdarksusy.a : $(DOBJ)
 	ar rS $(LIB)/libdarksusy.a $(BUILD)/*.o
 	ranlib $(LIB)/libdarksusy.a
 
+libdarksusy.so : $(DOBJ)
+	 $(FF) $(FOPT) -shared $(BUILD)/*.o $(DS_LIB)/libFH.so $(DS_LIB)/libHB.so $(DS_LIB)/libisajet.so -o $(DS_LIB)/libdarksusy.so 
+
 $(DOBJ) : 
 	cd $(@:_obj=) ; make all
 
 .PHONY: clean distclean $(DOBJ)
 distclean : clean
 	rm $(LIB)/libdarksusy.a
+	rm $(LIB)/libdarksusy.so
 clean : 
 	rm -f $(BUILD)/*.o
 
diff -rupN darksusy-5.1.3.pristine/src/nt/dsntmuonyield.f darksusy-5.1.3/src/nt/dsntmuonyield.f
--- darksusy-5.1.3.pristine/src/nt/dsntmuonyield.f	2013-01-31 21:46:16.000000000 +0000
+++ darksusy-5.1.3/src/nt/dsntmuonyield.f	2016-02-03 21:20:18.288408294 +0000
@@ -78,21 +78,16 @@ c      call wirate(6,6,1)
          stop
       endif
          
-      waistat=0
-
       yield = 0.d0
       if (ptype.eq.1 .or. ptype.eq.3) then
         yield=dswayield(wamwimp,emu,theta,wh,kind,t1,istat)
-        waistat=or(waistat,istat)
       endif
 
       if (ptype.eq.2 .or. ptype.eq.3) then
         yield=yield+dswayield(wamwimp,emu,theta,wh,kind,t2,istat)
-        waistat=or(waistat,istat)
       endif
       
       dsntmuonyield=yield
-      istat=waistat
 
       end
 
diff -rupN darksusy-5.1.3.pristine/src/wa/dswadydth.f darksusy-5.1.3/src/wa/dswadydth.f
--- darksusy-5.1.3.pristine/src/wa/dswadydth.f	2015-12-20 21:43:06.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswadydth.f	2016-02-02 18:42:09.797410390 +0000
@@ -8,7 +8,6 @@
       real*8 function dswadydth(cth, phim0,phim1,phim2,phie0,phieth,phithm,
      & phichi,phiwh,phifk,phifv)
       implicit none
-      include 'dswacom.h'
 
 c------------------------ variables ------------------------------------
 
diff -rupN darksusy-5.1.3.pristine/src/wa/dswaemean.f darksusy-5.1.3/src/wa/dswaemean.f
--- darksusy-5.1.3.pristine/src/wa/dswaemean.f	2009-03-30 13:08:08.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswaemean.f	2016-02-02 18:42:16.749410265 +0000
@@ -8,8 +8,6 @@
 
       real*8 function dswaemean(e0,m0,m1,m2)
       implicit none
-      include 'dswacom.h'
-      include 'dsidtag.h'
 
 c------------------------ variables ------------------------------------
 
diff -rupN darksusy-5.1.3.pristine/src/wa/dswaifind.f darksusy-5.1.3/src/wa/dswaifind.f
--- darksusy-5.1.3.pristine/src/wa/dswaifind.f	2008-04-07 22:27:47.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswaifind.f	2016-02-02 18:42:21.813410175 +0000
@@ -6,7 +6,6 @@
       subroutine dswaifind(value,array,ipl,ii,imin,imax)
       implicit none
 
-      include 'dswacom.h'
       include 'dsidtag.h'
 
       integer imin,imax,i,inew,imint,imaxt,iold,ii
diff -rupN darksusy-5.1.3.pristine/src/wa/dswainit.f darksusy-5.1.3/src/wa/dswainit.f
--- darksusy-5.1.3.pristine/src/wa/dswainit.f	2013-01-27 15:37:53.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswainit.f	2016-02-05 15:01:39.514975787 +0000
@@ -271,9 +271,9 @@ c     &            k,mfi
 
 c...Create mixed tables, differential in energy, integrated in theta
                 do l=0,zn-1
-                  tmpy=0.d0
+                  tmpy=0.e0
                   do m=0,thn
-                     tmpy=tmpy+phidiff(m,l,k,j,i,yli)*dth(m)
+                     tmpy=tmpy+phidiff(m,l,k,j,i,yli)*real(dth(m))
                      phimixed(m,l,k,j,i,yli)=tmpy
                   enddo
                 enddo
@@ -338,7 +338,6 @@ c     &   10.0d0,80.3d0,91.2d0,5*10.d0/
      &  1500.0d0,2000.0d0,3000.0d0,5000.0d0,7500.0d0,10000.0d0/
 c...Lowest mass index for the 14 channels chi
       data milow/1,1,1,1,4,16,1,12,13,1,1,1,1,1/
-      data waerr/0/
       data waftype/'b'/
 c      data wabase/'we-res-b-full'/
 c      data wabase/'we-res-may2012'/
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayield.f darksusy-5.1.3/src/wa/dswayield.f
--- darksusy-5.1.3.pristine/src/wa/dswayield.f	2011-05-24 09:54:48.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswayield.f	2016-02-02 18:42:34.557409946 +0000
@@ -59,8 +59,6 @@
       real*8 function dswayield(mneu,e,theta,wh,kind,type,istat)
       implicit none
       include 'dswacom.h'
-      include 'dsidtag.h'
-      include 'dsio.h'
 
 c------------------------ variables ------------------------------------
 
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayieldf.f darksusy-5.1.3/src/wa/dswayieldf.f
--- darksusy-5.1.3.pristine/src/wa/dswayieldf.f	2015-12-20 21:43:06.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswayieldf.f	2016-02-03 20:58:33.228431665 +0000
@@ -52,11 +52,13 @@
 
       real*8 function dswayieldf(mwimp,e,theta,chi,wh,kind,
      &  type,istat)
+      use omp_lib
       implicit none
       include 'dswacom.h'
       include 'dsidtag.h'
       include 'dsio.h'
 
+
 c------------------------ variables ------------------------------------
 
       real*8 mwimp,e,theta,phi1,phi2,mp1,mp2,zpl,thpl,mn,z,th,
@@ -64,7 +66,7 @@ c------------------------ variables ----
       integer chi,istat,zi,thi,m1i,m2i,whi,kind,type,yli,chii,ii
       character*2 wh
       logical wb
-      external dswacom, slog ! set up common block variables
+      external slog
 
 c-----------------------------------------------------------------------
 
@@ -73,8 +75,11 @@ c---------------------------------------
 
 c...Safecheck
       if (yli.eq.0) then
-         call dswainit(kind,type)
-         yli=yload(kind,type)
+        if (omp_get_thread_num() .eq. 0) then
+          call dswainit(kind,type)
+        endif
+!$omp barrier
+        yli=yload(kind,type)
       endif
 
       dswayieldf=0.0d0
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayieldfth.f darksusy-5.1.3/src/wa/dswayieldfth.f
--- darksusy-5.1.3.pristine/src/wa/dswayieldfth.f	2015-12-20 21:43:06.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswayieldfth.f	2016-02-02 18:43:57.029408469 +0000
@@ -6,7 +6,7 @@
 *****************************************************************************
 
       real*8 function dswayieldfth(e0,m0,mp1,mp2,emuthr,thmax,chi,wh,
-     &  kind,type,istat)
+     &  kind,type,istat,waerror)
       implicit none
       include 'dswacom.h'
       include 'dsidtag.h'
@@ -16,7 +16,7 @@ c------------------------ variables ----
 
       real*8 e0,m0,mp1,mp2,emuthr,thmax,m00,e00,thu
       real*8 mp1t,mp2t
-      integer chi,istat,kind,type
+      integer chi,istat,kind,type,waerror
       character*2 wh
 
       real*8 sum,emax,emin,e1cm,pi
@@ -149,9 +149,9 @@ c          endif
 
       if (wb) then
         if (wh.eq.'su'.or.wh.eq.'SU') then
-          sum=dswayield_int(dswadydth,cos(thu),1.0d0,chi,1,m00,mp1t,mp2t,e00,emuthr,thmax,kind,type)
+          sum=dswayield_int(dswadydth,cos(thu),1.0d0,chi,1,m00,mp1t,mp2t,e00,emuthr,thmax,kind,type,waerror)
         else
-          sum=dswayield_int(dswadydth,cos(thu),1.0d0,chi,2,m00,mp1t,mp2t,e00,emuthr,thmax,kind,type)
+          sum=dswayield_int(dswadydth,cos(thu),1.0d0,chi,2,m00,mp1t,mp2t,e00,emuthr,thmax,kind,type,waerror)
         endif
         dswayieldfth=sum*1.0d-15
       endif
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayield_int.f darksusy-5.1.3/src/wa/dswayield_int.f
--- darksusy-5.1.3.pristine/src/wa/dswayield_int.f	2015-12-20 21:43:06.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswayield_int.f	2016-03-11 12:33:44.337481034 +0000
@@ -1,5 +1,5 @@
       real*8 function dswayield_int(f,a,b,phichi,phiwh,phim0,phim1,phim2,
-     & phie0,phieth,phithm,phifk,phifv)        
+     & phie0,phieth,phithm,phifk,phifv,waerror)        
 
 c_______________________________________________________________________
 c  integrate function f between a and b
@@ -10,11 +10,10 @@ c  author: joakim edsjo (edsjo@physto.se
 c  based on paolo gondolos wxint.f routine.
 c=======================================================================
       implicit none
-      include 'dswacom.h'
       real*8 f,a,b,tot,eps,st,os,ost,del,sum,x
       real*8 phim0,phim1,phim2,phie0,phieth,phithm
       integer phichi,phiwh,phifk,phifv   ! phiwh=1 - sun, 2 - earth
-      integer jmax,it,l,j,nfcn,jdid
+      integer jmax,it,l,j,nfcn,jdid,waerror
       external f
 c      parameter (a=-1.0,b=1.0,eps=1.0d-4,jmax=20)
       parameter (eps=1.0d-2,jmax=30)  ! je change in eps ps change in jmax
@@ -50,8 +49,11 @@ c      parameter (a=-1.0,b=1.0,eps=1.0d-
 c        type *,'jdid',jdid,' os',os, 'ost',ost
       enddo
 
+!$omp critical (stdout)
       write(*,*) 'DS WARNING: too many steps in dswayield_int.'
-      waerr=1
+!$omp end critical (stdout)
+
+      waerror=1
       dswayield_int=0.0d0
 
       end
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayieldone.f darksusy-5.1.3/src/wa/dswayieldone.f
--- darksusy-5.1.3.pristine/src/wa/dswayieldone.f	2013-01-31 21:46:16.000000000 +0000
+++ darksusy-5.1.3/src/wa/dswayieldone.f	2016-03-11 12:33:56.297480568 +0000
@@ -105,16 +105,16 @@
 *****************************************************************************
 
       real*8 function dswayieldone(mneu,e,theta,ch,wh,kind,type,istat)
+      use omp_lib
       implicit none
       include 'dswacom.h'
       include 'dsidtag.h'
-      include 'dsio.h'
 
 c------------------------ variables ------------------------------------
 
       real*8 mneu,e,theta,flx
       real*8 mp1,mp2,e1,e2
-      integer ch,chi,istat,i,kind,type
+      integer ch,chi,istat,waerror,i,kind,type
       character*2 wh
 
       logical chok
@@ -134,7 +134,7 @@ c---------------------------------------
 c      write(*,*) 'dswayieldone called with ',kind,type
 
       istat=0
-      waerr=0
+      waerror=0
       mp1=0.d0
       mp2=0.d0
 
@@ -142,19 +142,24 @@ c      write(*,*) 'dswayieldone called w
 
 c--------------------------------------- if first call, load yield tables
 
-
       if (first) then
-        do i=1,26
-           yload(1,i)=0
-           yload(2,i)=0
-        enddo
-        walast(1)=0 ! last index for integrated yields stored in memory
-        walast(2)=0 ! last index for differential yields stored in memory
-        first=.false.
+        if (omp_get_thread_num() .eq. 0) then
+          do i=1,26
+             yload(1,i)=0
+             yload(2,i)=0
+          enddo
+          walast(1)=0 ! last index for integrated yields stored in memory
+          walast(2)=0 ! last index for differential yields stored in memory
+          first=.false.
+        endif
+!$omp barrier
       endif
 
       if (yload(kind2ki(kind),type).eq.0) then
-        call dswainit(kind,type)
+        if (omp_get_thread_num() .eq. 0) then
+          call dswainit(kind,type)
+        endif
+!$omp barrier
       endif
 
 c-----------------------------------------------------------------------
@@ -233,59 +238,59 @@ c...check different annihilation channel
 
 c---------- S10 S10 channel ----------
           if (ch.eq.1) then
-            flx=flx+2.d0*dswayields(e1,e,theta,1,wh,kind,type,istat)
+            flx=flx+2.d0*dswayields(e1,e,theta,1,wh,kind,type,istat,waerror)
 
 c---------- S10 S20 channel ----------
           elseif (ch.eq.2) then
-            flx=flx+dswayields(e1,e,theta,1,wh,kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,2,wh,kind,type,istat)
+            flx=flx+dswayields(e1,e,theta,1,wh,kind,type,istat,waerror)
+            flx=flx+dswayields(e2,e,theta,2,wh,kind,type,istat,waerror)
 
 c---------- S20 S20 channel ----------
           elseif (ch.eq.3) then
-            flx=flx+2.d0*dswayields(e1,e,theta,2,wh,kind,type,istat)
+            flx=flx+2.d0*dswayields(e1,e,theta,2,wh,kind,type,istat,waerror)
 
 c---------- S30 S30 channel ----------
           elseif (ch.eq.4) then
-            flx=flx+2.d0*dswayields(e1,e,theta,3,wh,kind,type,istat)
+            flx=flx+2.d0*dswayields(e1,e,theta,3,wh,kind,type,istat,waerror)
 
 c---------- S10 S30 channel ----------
           elseif (ch.eq.5) then
-            flx=flx+dswayields(e1,e,theta,1,wh,kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat)
+            flx=flx+dswayields(e1,e,theta,1,wh,kind,type,istat,waerror)
+            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat,waerror)
 
 c---------- S20 S30 channel ----------
           elseif (ch.eq.6) then
-            flx=flx+dswayields(e1,e,theta,2,wh,kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat)
+            flx=flx+dswayields(e1,e,theta,2,wh,kind,type,istat,waerror)
+            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat,waerror)
 
 c---------- S+ S- channel ----------
           elseif (ch.eq.7) then
-            flx=flx+2.d0*dswayields(e1,e,theta,4,wh,kind,type,istat)
+            flx=flx+2.d0*dswayields(e1,e,theta,4,wh,kind,type,istat,waerror)
 
 c---------- Z0 S10 channel ----------
           elseif (ch.eq.8) then
             flx=flx+0.5d0*dswayieldf(e1,e,theta,9,wh,
      &        kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,1,wh,kind,type,istat)
+            flx=flx+dswayields(e2,e,theta,1,wh,kind,type,istat,waerror)
 
 c---------- Z0 S20 channel ----------
           elseif (ch.eq.9) then
             flx=flx+0.5d0*dswayieldf(e1,e,theta,9,wh,
      &        kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,2,wh,kind,type,istat)
+            flx=flx+dswayields(e2,e,theta,2,wh,kind,type,istat,waerror)
 
 c---------- Z0 S30 channel ----------
           elseif (ch.eq.10) then
             flx=flx+0.5d0*dswayieldf(e1,e,theta,9,wh,
      &        kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat)
+            flx=flx+dswayields(e2,e,theta,3,wh,kind,type,istat,waerror)
 
 c---------- w+h- w-h+ channel ----------
 c...this calculation gives a mean of the two channels w+h- & w-h+
           elseif (ch.eq.11) then
             flx=flx+0.5d0*dswayieldf(e1,e,theta,8,wh,
      &        kind,type,istat)
-            flx=flx+dswayields(e2,e,theta,4,wh,kind,type,istat)
+            flx=flx+dswayields(e2,e,theta,4,wh,kind,type,istat,waerror)
 
 c---------- z0 gamma channel ----------
           elseif (ch.eq.29) then
@@ -307,14 +312,15 @@ c          endif
 
       endif
 
-      if (waerr.gt.0) then
+      if (waerror.gt.0) then
+!$omp critical (stdout)
         write(*,*) 'DS WARNING in dswayieldone for model ',idtag,
      &    ', yield type ',type,' and channel ',ch
         write(*,*) '  the integration over scalar decay angles ran',
      &    ' into numerical problems.'
         write(*,*) '  The results can only be trusted as a lower',
      &    'bound.'
-        waistat=ibset(waistat,2)
+!$omp end critical (stdout)
         istat=ibset(istat,2)
       endif
 
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayields2.f darksusy-5.1.3/src/wa/dswayields2.f
--- darksusy-5.1.3.pristine/src/wa/dswayields2.f	2009-05-08 09:54:47.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswayields2.f	2016-02-01 19:48:57.413275000 +0000
@@ -8,14 +8,14 @@
 *****************************************************************************
 
       real*8 function dswayields2(eh,emuth,thmax,hno,wh,kind,
-     &  type,istat)
+     &  type,istat,waerror)
       implicit none
       include 'dswacom.h'
 
 c------------------------ variables ------------------------------------
 
       real*8 eh,emuth,thmax
-      integer hno,istat,kind,type,chi
+      integer hno,istat,waerror,kind,type,chi
       character*2 wh
 
       real*8 e1,e2,yield
@@ -39,7 +39,7 @@ c..."fundamental" channels
           if (was0br(chi2ch(chi),hno).gt.0.0d0) then
             yield=yield+was0br(chi2ch(chi),hno)*2.0d0*
      &        dswayieldfth(eh,was0m(hno),map(chi),map(chi),emuth,thmax,
-     &          chi,wh,kind,type,istat)
+     &          chi,wh,kind,type,istat,waerror)
           endif
   100   continue
 
@@ -47,95 +47,95 @@ c..."complex" channels
         if (was0br(1,hno).gt.0.0d0) then    ! S10 S10 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(1))
           yield=yield+2.0*was0br(1,hno)*dswayields3(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(2,hno).gt.0.0d0) then    ! S10 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(2))
           yield=yield+was0br(2,hno)*dswayields3(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(2),was0m(1))
           yield=yield+was0br(2,hno)*dswayields3(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(3,hno).gt.0.0d0) then    ! S20 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(2))
           yield=yield+2.0*was0br(3,hno)*dswayields3(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(4,hno).gt.0.0d0) then    ! S30 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(3),was0m(3))
           yield=yield+2.0*was0br(4,hno)*dswayields3(e1,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(5,hno).gt.0.0d0) then    ! S10 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(3))
           yield=yield+was0br(5,hno)*dswayields3(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(1))
           yield=yield+was0br(5,hno)*dswayields3(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(6,hno).gt.0.0d0) then    ! S20 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(3))
           yield=yield+was0br(6,hno)*dswayields3(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(2))
           yield=yield+was0br(6,hno)*dswayields3(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(7,hno).gt.0.0d0) then    ! S+ S- channel
           e1=dswaemean(eh,was0m(hno),wascm,wascm)
           yield=yield+2.0*
      &      was0br(7,hno)*dswayields3(e1,emuth,thmax,4,wh,
-     &        kind,type,istat)
+     &        kind,type,istat,waerror)
         endif
 
         if (was0br(8,hno).gt.0.0d0) then    ! z0 S10 channel
           e2=dswaemean(eh,was0m(hno),was0m(1),map(9))
           yield=yield+was0br(8,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(1),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(8,hno)*dswayields3(e2,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(9,hno).gt.0.0d0) then    ! z0 S20 channel
           e2=dswaemean(eh,was0m(hno),was0m(2),map(9))
           yield=yield+was0br(9,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(2),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(9,hno)*dswayields3(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(10,hno).gt.0.0d0) then    ! z0 S30 channel
           e2=dswaemean(eh,was0m(hno),was0m(3),map(9))
           yield=yield+was0br(10,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(3),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(10,hno)*dswayields3(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(11,hno).gt.0.0d0) then    ! w-S+ w+S- channel
           e2=dswaemean(eh,was0m(hno),wascm,map(8))
           yield=yield+was0br(11,hno)*
      +    dswayieldfth(eh,was0m(hno),map(8),wascm,emuth,thmax,
-     &      8,wh,kind,type,istat)
+     &      8,wh,kind,type,istat,waerror)
           yield=yield+was0br(11,hno)*dswayields3(e2,emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(29,hno).gt.0.0d0) then    ! Z0 gamma
           yield=yield+was0br(29,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),0.0d0,emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
         endif
 
 c---------- charged scalar bosons ----------
@@ -144,118 +144,118 @@ c---------- charged scalar bosons ------
         if (wascbr(1).gt.0.0d0) then ! u d-bar
            yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(1),map(2),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(2),map(1),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(2).gt.0.0d0) then ! u s-bar
            yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(3),map(2),emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
           yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(2),map(3),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(3).gt.0.0d0) then ! u b-bar
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(5),map(2),emuth,thmax,
-     &      5,wh,kind,type,istat)
+     &      5,wh,kind,type,istat,waerror)
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(2),map(5),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(4).gt.0.0d0) then ! c d-bar
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(4),map(1),emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(1),map(4),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(5).gt.0.0d0) then ! c s-bar
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(4),map(3),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(3),map(4),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(6).gt.0.0d0) then ! c b-bar
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(4),map(5),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(5),map(4),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(7).gt.0.0d0) then ! t d-bar
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(6),map(1),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(1),map(6),emuth,thmax,
-     &    1,wh,kind,type,istat)
+     &    1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(8).gt.0.0d0) then ! t s-bar
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(6),map(3),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(3),map(6),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(9).gt.0.0d0) then ! t b-bar
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(6),map(5),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(5),map(6),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(12).gt.0.0d0) then ! tau nu_tau
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(11),map(14),emuth,thmax,
-     &    11,wh,kind,type,istat)
+     &    11,wh,kind,type,istat,waerror)
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(14),map(11),emuth,thmax,
-     &    14,wh,kind,type,istat)
+     &    14,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(13).gt.0.0d0) then ! w+ h1
           yield=yield+wascbr(13)*
      &    dswayieldfth(eh,wascm,map(8),was0m(1),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(1),map(8))
           yield=yield+wascbr(13)*
-     &      dswayields3(e2,emuth,thmax,1,wh,kind,type,istat)
+     &      dswayields3(e2,emuth,thmax,1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(14).gt.0.0d0) then ! w+ h2
           yield=yield+wascbr(14)*
      &    dswayieldfth(eh,wascm,map(8),was0m(2),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(2),map(8))
           yield=yield+wascbr(14)*
-     &      dswayields3(e2,emuth,thmax,2,wh,kind,type,istat)
+     &      dswayields3(e2,emuth,thmax,2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(15).gt.0.0d0) then ! w+ h3
           yield=yield+wascbr(15)*
      &    dswayieldfth(eh,wascm,map(8),was0m(3),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(3),map(8))
           yield=yield+wascbr(15)*
-     &      dswayields3(e2,emuth,thmax,3,wh,kind,type,istat)
+     &      dswayields3(e2,emuth,thmax,3,wh,kind,type,istat,waerror)
         endif
 
       endif
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayields3.f darksusy-5.1.3/src/wa/dswayields3.f
--- darksusy-5.1.3.pristine/src/wa/dswayields3.f	2009-05-08 09:54:47.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswayields3.f	2016-02-01 19:48:57.413275000 +0000
@@ -8,14 +8,14 @@
 *****************************************************************************
 
       real*8 function dswayields3(eh,emuth,thmax,hno,wh,kind,
-     &  type,istat)
+     &  type,istat,waerror)
       implicit none
       include 'dswacom.h'
 
 c------------------------ variables ------------------------------------
 
       real*8 eh,emuth,thmax
-      integer hno,istat,kind,type,chi
+      integer hno,istat,waerror,kind,type,chi
       character*2 wh
 
       real*8 e1,e2,yield
@@ -39,7 +39,7 @@ c..."fundamental" channels
           if (was0br(chi2ch(chi),hno).gt.0.0d0) then
             yield=yield+was0br(chi2ch(chi),hno)*2.0d0*
      &        dswayieldfth(eh,was0m(hno),map(chi),map(chi),emuth,thmax,
-     &          chi,wh,kind,type,istat)
+     &          chi,wh,kind,type,istat,waerror)
           endif
   100   continue
 
@@ -47,95 +47,95 @@ c..."complex" channels
         if (was0br(1,hno).gt.0.0d0) then    ! S10 S10 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(1))
           yield=yield+2.0*was0br(1,hno)*dswayields4(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(2,hno).gt.0.0d0) then    ! S10 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(2))
           yield=yield+was0br(2,hno)*dswayields4(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(2),was0m(1))
           yield=yield+was0br(2,hno)*dswayields4(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(3,hno).gt.0.0d0) then    ! S20 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(2))
           yield=yield+2.0*was0br(3,hno)*dswayields4(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(4,hno).gt.0.0d0) then    ! S30 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(3),was0m(3))
           yield=yield+2.0*was0br(4,hno)*dswayields4(e1,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(5,hno).gt.0.0d0) then    ! S10 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(3))
           yield=yield+was0br(5,hno)*dswayields4(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(1))
           yield=yield+was0br(5,hno)*dswayields4(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(6,hno).gt.0.0d0) then    ! S20 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(3))
           yield=yield+was0br(6,hno)*dswayields4(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(2))
           yield=yield+was0br(6,hno)*dswayields4(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(7,hno).gt.0.0d0) then    ! S+ S- channel
           e1=dswaemean(eh,was0m(hno),wascm,wascm)
           yield=yield+2.0*
      &      was0br(7,hno)*dswayields4(e1,emuth,thmax,4,wh,
-     &        kind,type,istat)
+     &        kind,type,istat,waerror)
         endif
 
         if (was0br(8,hno).gt.0.0d0) then    ! z0 S10 channel
           e2=dswaemean(eh,was0m(hno),was0m(1),map(9))
           yield=yield+was0br(8,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(1),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(8,hno)*dswayields4(e2,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(9,hno).gt.0.0d0) then    ! z0 S20 channel
           e2=dswaemean(eh,was0m(hno),was0m(2),map(9))
           yield=yield+was0br(9,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(2),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(9,hno)*dswayields4(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(10,hno).gt.0.0d0) then    ! z0 S30 channel
           e2=dswaemean(eh,was0m(hno),was0m(3),map(9))
           yield=yield+was0br(10,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(3),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(10,hno)*dswayields4(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(11,hno).gt.0.0d0) then    ! w-S+ w+S- channel
           e2=dswaemean(eh,was0m(hno),wascm,map(8))
           yield=yield+was0br(11,hno)*
      +    dswayieldfth(eh,was0m(hno),map(8),wascm,emuth,thmax,
-     &      8,wh,kind,type,istat)
+     &      8,wh,kind,type,istat,waerror)
           yield=yield+was0br(11,hno)*dswayields4(e2,emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(29,hno).gt.0.0d0) then    ! Z0 gamma
           yield=yield+was0br(29,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),0.0d0,emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
         endif
 
 c---------- charged scalar bosons ----------
@@ -144,118 +144,118 @@ c---------- charged scalar bosons ------
         if (wascbr(1).gt.0.0d0) then ! u d-bar
            yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(1),map(2),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(2),map(1),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(2).gt.0.0d0) then ! u s-bar
            yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(3),map(2),emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
           yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(2),map(3),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(3).gt.0.0d0) then ! u b-bar
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(5),map(2),emuth,thmax,
-     &      5,wh,kind,type,istat)
+     &      5,wh,kind,type,istat,waerror)
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(2),map(5),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(4).gt.0.0d0) then ! c d-bar
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(4),map(1),emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(1),map(4),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(5).gt.0.0d0) then ! c s-bar
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(4),map(3),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(3),map(4),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(6).gt.0.0d0) then ! c b-bar
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(4),map(5),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(5),map(4),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(7).gt.0.0d0) then ! t d-bar
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(6),map(1),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(1),map(6),emuth,thmax,
-     &    1,wh,kind,type,istat)
+     &    1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(8).gt.0.0d0) then ! t s-bar
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(6),map(3),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(3),map(6),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(9).gt.0.0d0) then ! t b-bar
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(6),map(5),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(5),map(6),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(12).gt.0.0d0) then ! tau nu_tau
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(11),map(14),emuth,thmax,
-     &    11,wh,kind,type,istat)
+     &    11,wh,kind,type,istat,waerror)
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(14),map(11),emuth,thmax,
-     &    14,wh,kind,type,istat)
+     &    14,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(13).gt.0.0d0) then ! w+ h1
           yield=yield+wascbr(13)*
      &    dswayieldfth(eh,wascm,map(8),was0m(1),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(1),map(8))
           yield=yield+wascbr(13)*
-     &      dswayields4(e2,emuth,thmax,1,wh,kind,type,istat)
+     &      dswayields4(e2,emuth,thmax,1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(14).gt.0.0d0) then ! w+ h2
           yield=yield+wascbr(14)*
      &    dswayieldfth(eh,wascm,map(8),was0m(2),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(2),map(8))
           yield=yield+wascbr(14)*
-     &      dswayields4(e2,emuth,thmax,2,wh,kind,type,istat)
+     &      dswayields4(e2,emuth,thmax,2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(15).gt.0.0d0) then ! w+ h3
           yield=yield+wascbr(15)*
      &    dswayieldfth(eh,wascm,map(8),was0m(3),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(3),map(8))
           yield=yield+wascbr(15)*
-     &      dswayields4(e2,emuth,thmax,3,wh,kind,type,istat)
+     &      dswayields4(e2,emuth,thmax,3,wh,kind,type,istat,waerror)
         endif
 
       endif
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayields4.f darksusy-5.1.3/src/wa/dswayields4.f
--- darksusy-5.1.3.pristine/src/wa/dswayields4.f	2009-05-08 09:54:47.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswayields4.f	2016-02-01 19:48:57.413275000 +0000
@@ -8,7 +8,7 @@
 *****************************************************************************
 
       real*8 function dswayields4(eh,emuth,thmax,hno,wh,
-     &  kind,type,istat)
+     &  kind,type,istat,waerror)
       implicit none
       include 'dswacom.h'
       include 'dsidtag.h'
@@ -16,7 +16,7 @@
 c------------------------ variables ------------------------------------
 
       real*8 eh,emuth,thmax
-      integer hno,istat,kind,type
+      integer hno,istat,waerror,kind,type
       character*2 wh
 
       real*8 yield
@@ -40,7 +40,7 @@ c..."fundamental" channels
           if (was0br(chi2ch(chi),hno).gt.0.0d0) then
             yield=yield+was0br(chi2ch(chi),hno)*2.0d0*
      &        dswayieldfth(eh,was0m(hno),map(chi),map(chi),emuth,thmax,
-     &          chi,wh,kind,type,istat)
+     &          chi,wh,kind,type,istat,waerror)
           endif
   100   continue
 
@@ -51,91 +51,91 @@ c---------- charged scalar bosons ------
         if (wascbr(1).gt.0.0d0) then ! u d-bar
            yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(1),map(2),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(2),map(1),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(2).gt.0.0d0) then ! u s-bar
            yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(3),map(2),emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
           yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(2),map(3),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(3).gt.0.0d0) then ! u b-bar
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(5),map(2),emuth,thmax,
-     &      5,wh,kind,type,istat)
+     &      5,wh,kind,type,istat,waerror)
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(2),map(5),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(4).gt.0.0d0) then ! c d-bar
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(4),map(1),emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(1),map(4),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(5).gt.0.0d0) then ! c s-bar
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(4),map(3),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(3),map(4),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(6).gt.0.0d0) then ! c b-bar
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(4),map(5),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(5),map(4),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(7).gt.0.0d0) then ! t d-bar
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(6),map(1),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(1),map(6),emuth,thmax,
-     &    1,wh,kind,type,istat)
+     &    1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(8).gt.0.0d0) then ! t s-bar
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(6),map(3),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(3),map(6),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(9).gt.0.0d0) then ! t b-bar
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(6),map(5),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(5),map(6),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(12).gt.0.0d0) then ! tau nu_tau
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(11),map(14),emuth,thmax,
-     &    11,wh,kind,type,istat)
+     &    11,wh,kind,type,istat,waerror)
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(14),map(11),emuth,thmax,
-     &    14,wh,kind,type,istat)
+     &    14,wh,kind,type,istat,waerror)
         endif
 
       endif
diff -rupN darksusy-5.1.3.pristine/src/wa/dswayields.f darksusy-5.1.3/src/wa/dswayields.f
--- darksusy-5.1.3.pristine/src/wa/dswayields.f	2009-05-08 09:54:47.000000000 +0100
+++ darksusy-5.1.3/src/wa/dswayields.f	2016-02-01 19:48:57.409275000 +0000
@@ -8,14 +8,14 @@
 *****************************************************************************
 
       real*8 function dswayields(eh,emuth,thmax,hno,wh,kind,
-     &  type,istat)
+     &  type,istat,waerror)
       implicit none
       include 'dswacom.h'
 
 c------------------------ variables ------------------------------------
 
       real*8 eh,emuth,thmax
-      integer hno,istat,kind,type,chi
+      integer hno,istat,waerror,kind,type,chi
       character*2 wh
 
       real*8 e1,e2,yield
@@ -38,7 +38,7 @@ c..."fundamental" channels
           if (was0br(chi2ch(chi),hno).gt.0.0d0) then
             yield=yield+was0br(chi2ch(chi),hno)*2.0d0*
      &        dswayieldfth(eh,was0m(hno),map(chi),map(chi),emuth,thmax,
-     &          chi,wh,kind,type,istat)
+     &          chi,wh,kind,type,istat,waerror)
           endif
   100   continue
 
@@ -46,95 +46,95 @@ c..."complex" channels
         if (was0br(1,hno).gt.0.0d0) then    ! S10 S10 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(1))
           yield=yield+2.0*was0br(1,hno)*dswayields2(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(2,hno).gt.0.0d0) then    ! S10 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(2))
           yield=yield+was0br(2,hno)*dswayields2(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(2),was0m(1))
           yield=yield+was0br(2,hno)*dswayields2(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(3,hno).gt.0.0d0) then    ! S20 S20 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(2))
           yield=yield+2.0*was0br(3,hno)*dswayields2(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(4,hno).gt.0.0d0) then    ! S30 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(3),was0m(3))
           yield=yield+2.0*was0br(4,hno)*dswayields2(e1,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(5,hno).gt.0.0d0) then    ! S10 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(1),was0m(3))
           yield=yield+was0br(5,hno)*dswayields2(e1,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(1))
           yield=yield+was0br(5,hno)*dswayields2(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(6,hno).gt.0.0d0) then    ! S20 S30 channel
           e1=dswaemean(eh,was0m(hno),was0m(2),was0m(3))
           yield=yield+was0br(6,hno)*dswayields2(e1,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,was0m(hno),was0m(3),was0m(2))
           yield=yield+was0br(6,hno)*dswayields2(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(7,hno).gt.0.0d0) then    ! S+ S- channel
           e1=dswaemean(eh,was0m(hno),wascm,wascm)
           yield=yield+2.0*
      &      was0br(7,hno)*dswayields2(e1,emuth,thmax,4,wh,
-     &        kind,type,istat)
+     &        kind,type,istat,waerror)
         endif
 
         if (was0br(8,hno).gt.0.0d0) then    ! z0 S10 channel
           e2=dswaemean(eh,was0m(hno),was0m(1),map(9))
           yield=yield+was0br(8,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(1),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(8,hno)*dswayields2(e2,emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(9,hno).gt.0.0d0) then    ! z0 S20 channel
           e2=dswaemean(eh,was0m(hno),was0m(2),map(9))
           yield=yield+was0br(9,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(2),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(9,hno)*dswayields2(e2,emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(10,hno).gt.0.0d0) then    ! z0 S30 channel
           e2=dswaemean(eh,was0m(hno),was0m(3),map(9))
           yield=yield+was0br(10,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),was0m(3),emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
           yield=yield+was0br(10,hno)*dswayields2(e2,emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(11,hno).gt.0.0d0) then    ! w-S+ w+S- channel
           e2=dswaemean(eh,was0m(hno),wascm,map(8))
           yield=yield+was0br(11,hno)*
      +    dswayieldfth(eh,was0m(hno),map(8),wascm,emuth,thmax,
-     &      8,wh,kind,type,istat)
+     &      8,wh,kind,type,istat,waerror)
           yield=yield+was0br(11,hno)*dswayields2(e2,emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
         endif
 
         if (was0br(29,hno).gt.0.0d0) then    ! Z0 gamma
           yield=yield+was0br(29,hno)*
      +    dswayieldfth(eh,was0m(hno),map(9),0.0d0,emuth,thmax,
-     &      9,wh,kind,type,istat)
+     &      9,wh,kind,type,istat,waerror)
         endif
 c        write(*,*) '   ...after complex: ',yield
 
@@ -144,118 +144,118 @@ c---------- charged scalar bosons ------
         if (wascbr(1).gt.0.0d0) then ! u d-bar
            yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(1),map(2),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
           yield=yield+wascbr(1)*
      &    dswayieldfth(eh,wascm,map(2),map(1),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(2).gt.0.0d0) then ! u s-bar
            yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(3),map(2),emuth,thmax,
-     &      3,wh,kind,type,istat)
+     &      3,wh,kind,type,istat,waerror)
           yield=yield+wascbr(2)*
      &    dswayieldfth(eh,wascm,map(2),map(3),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(3).gt.0.0d0) then ! u b-bar
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(5),map(2),emuth,thmax,
-     &      5,wh,kind,type,istat)
+     &      5,wh,kind,type,istat,waerror)
           yield=yield+wascbr(3)*
      &    dswayieldfth(eh,wascm,map(2),map(5),emuth,thmax,
-     &      2,wh,kind,type,istat)
+     &      2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(4).gt.0.0d0) then ! c d-bar
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(4),map(1),emuth,thmax,
-     &      4,wh,kind,type,istat)
+     &      4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(4)*
      &    dswayieldfth(eh,wascm,map(1),map(4),emuth,thmax,
-     &      1,wh,kind,type,istat)
+     &      1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(5).gt.0.0d0) then ! c s-bar
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(4),map(3),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(5)*
      &    dswayieldfth(eh,wascm,map(3),map(4),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(6).gt.0.0d0) then ! c b-bar
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(4),map(5),emuth,thmax,
-     &    4,wh,kind,type,istat)
+     &    4,wh,kind,type,istat,waerror)
           yield=yield+wascbr(6)*
      &    dswayieldfth(eh,wascm,map(5),map(4),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(7).gt.0.0d0) then ! t d-bar
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(6),map(1),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(7)*
      &    dswayieldfth(eh,wascm,map(1),map(6),emuth,thmax,
-     &    1,wh,kind,type,istat)
+     &    1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(8).gt.0.0d0) then ! t s-bar
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(6),map(3),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(8)*
      &    dswayieldfth(eh,wascm,map(3),map(6),emuth,thmax,
-     &    3,wh,kind,type,istat)
+     &    3,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(9).gt.0.0d0) then ! t b-bar
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(6),map(5),emuth,thmax,
-     &    6,wh,kind,type,istat)
+     &    6,wh,kind,type,istat,waerror)
           yield=yield+wascbr(9)*
      &    dswayieldfth(eh,wascm,map(5),map(6),emuth,thmax,
-     &    5,wh,kind,type,istat)
+     &    5,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(12).gt.0.0d0) then ! tau nu_tau
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(11),map(14),emuth,thmax,
-     &    11,wh,kind,type,istat)
+     &    11,wh,kind,type,istat,waerror)
           yield=yield+wascbr(12)*
      &    dswayieldfth(eh,wascm,map(14),map(11),emuth,thmax,
-     &    14,wh,kind,type,istat)
+     &    14,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(13).gt.0.0d0) then ! w+ h1
           yield=yield+wascbr(13)*
      &    dswayieldfth(eh,wascm,map(8),was0m(1),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(1),map(8))
           yield=yield+wascbr(13)*
-     &      dswayields2(e2,emuth,thmax,1,wh,kind,type,istat)
+     &      dswayields2(e2,emuth,thmax,1,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(14).gt.0.0d0) then ! w+ h2
           yield=yield+wascbr(14)*
      &    dswayieldfth(eh,wascm,map(8),was0m(2),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(2),map(8))
           yield=yield+wascbr(14)*
-     &      dswayields2(e2,emuth,thmax,2,wh,kind,type,istat)
+     &      dswayields2(e2,emuth,thmax,2,wh,kind,type,istat,waerror)
         endif
 
         if (wascbr(15).gt.0.0d0) then ! w+ h3
           yield=yield+wascbr(15)*
      &    dswayieldfth(eh,wascm,map(8),was0m(3),emuth,thmax,
-     &    8,wh,kind,type,istat)
+     &    8,wh,kind,type,istat,waerror)
           e2=dswaemean(eh,wascm,was0m(3),map(8))
           yield=yield+wascbr(15)*
-     &      dswayields2(e2,emuth,thmax,3,wh,kind,type,istat)
+     &      dswayields2(e2,emuth,thmax,3,wh,kind,type,istat,waerror)
         endif
 
       endif
