*** ../../Backends/installed/MultiModeCode/2.0.0/modpk_utils.f90	2015-04-20 16:36:02.000000000 +0100
--- ../../Backends/include/gambit/Backends/backend_types/MultiModeCode_2_0_0/modpk_utils.f90	2018-05-21 16:02:29.000000000 +0100
***************
*** 92,99 ****
      real(dp), DIMENSION(:), INTENT(OUT) :: yprime
  
      !MULTIFIELD
!     real(dp), DIMENSION(size(y)/2) :: p, delp
!     real(dp) :: hubble,dhubble, eps
      !END MULTIFIEND
  
      integer :: i
--- 92,99 ----
      real(dp), DIMENSION(:), INTENT(OUT) :: yprime
  
      !MULTIFIELD
!     real(dp), DIMENSION(size(y)/2) :: p, delp, dVpot
!     real(dp) :: hubble,dhubble, eps, Vpot
      !END MULTIFIEND
  
      integer :: i
***************
*** 106,111 ****
--- 106,114 ----
      !MULTIFIELD
      p = y(1 : size(y)/2)
      delp = y(size(y)/2+1 : size(y))
+ 
+     Vpot = pot(p)
+ 	dVpot = dVdphi(p)
      !END MULTIFIELD
  
      if (.not. use_t) then
***************
*** 157,168 ****
      !MULTIFIELD
      if (.not. use_t) then
        !Derivs wrt e-folds
-       hubble=getH(p,delp)
-       dhubble=getdHdalpha(p,delp)
  
        yprime(1 : size(y)/2) = delp
!       yprime(size(y)/2+1 : size(y)) = -((3.0e0_dp+dhubble/hubble)*delp+&
!         dVdphi(p)/hubble/hubble)
      else
  
        !Derivs in cosmic time
--- 160,190 ----
      !MULTIFIELD
      if (.not. use_t) then
        !Derivs wrt e-folds
  
        yprime(1 : size(y)/2) = delp
! 
!       if (potential_choice == 18) then
!         yprime(size(y)/2+1: size(y)) = -3.0e0_dp*delp + &
!                          delp**3/2.0e0_dp - (3.0e0_dp - &
!                          delp**2/2.0e0_dp)* &
!                          sqrt(2.0e0_dp*getEps(p,delp))
!         ! print*, "hubble = ", hubble
!         ! print*, "dhubble = ", dhubble
! 		! print*, "delp = " , delp
! 		! print*, "getEps(p,delp) = ", getEps(p,delp)
!         ! print*, "-dhubble/hubble**2 = ", -dhubble/hubble**2
!         ! print*, " -3.0e0_dp*delp(1) = ", -3.0e0_dp*delp(1)
!         ! print*, " delp(1)**3/2.0e0_dp = ", delp(1)**3/2.0e0_dp
!         ! print*, "y from inside utils = " , yprime(size(y)/2+1: size(y))
!         ! print*, " sqrt(2eps) = ", sqrt(2.0e0_dp*dVpot(1)/Vpot)
! 
! 	  else
!         hubble=getH(p,delp)
!         dhubble=getdHdalpha(p,delp)
! 
!         yprime(size(y)/2+1 : size(y)) = -((3.0e0_dp+dhubble/hubble)*delp+&
!           dVdphi(p)/hubble/hubble)
!       end if
      else
  
        !Derivs in cosmic time
