##########################################################################
##
##
##      Example yaml file for CosmoALPs
##
##  \author Patrick Stoecker <stoecker@physik.rwth-aachen.de>
##      \date 2020 Sep
##
##########################################################################

Parameters:

  LCDM:
    omega_b:
      prior_type: flat
      range: [0.020,0.024]
    omega_cdm:
      prior_type: flat
      range: [0.10,0.13]
    H0:
      prior_type: flat
      range: [62,74]
    tau_reio:
      prior_type: flat
      range: [0.004,0.20]
    T_cmb:
      fixed_value: 2.72548

  PowerLaw_ps:
    ln10A_s:
      prior_type: flat
      range: [2.9,3.2]
    n_s:
      prior_type: flat
      range: [0.9,1.10]
    r: 0
    N_pivot: 55

  StandardModel_SLHA2: !import include/StandardModel_SLHA2_Planckbaseline.yaml

  # Model Parameters of GeneralCosmoALP
  # This automatically activates etaBBN_rBBN_rCMB_dNurBBN_dNurCMB and DecayingDM_photon
  # such that there is no need to specifies these models.
  GeneralCosmoALP:
    gagg:
      range: [1e-20, 1e-3]
      prior_type: log
    ma0:
      range: [1e2, 1e7]
      prior_type: log
    f0_thermal:
      range: [1e-15, 1e2]
    fa: 1e9
    thetai: 0.0
    T_R: 5.0
    beta: 0.0
    Tchi: 1e99
    gaee: 0.0
    gaN: 0.0

  cosmo_nuisance_Planck_lite: !import include/Planck_2018/cosmo_nuisance_Planck_lite_flat.yaml

  cosmo_nuisance_Pantheon:
    M:
      prior_type: flat
      range: [-20,-18]

  nuclear_params_neutron_lifetime:
    neutron_lifetime:
      range: [875,895]

  rBBN_dNurBBN:
    r_BBN: 1.0
    dNur_BBN: 0.0

Priors:

Printer:

  printer: cout

  #printer: ascii
  #options:
  #  output_file: "gambit_output.data"

Scanner:

  use_scanner: random

  scanners:
    multinest:
      plugin: multinest
      like:  LogLike
      nlive: 1000
      tol: 0.01

    random:
      plugin: random
      point_number: 20
      like:  LogLike

ObsLikes:

  # ---- BBN -----
  # Likelihood from BBN, based only helium and deuterium abundances
  - purpose:      LogLike
    capability:   BBN_LogLike
    sub_capabilities: [He4, D]

  # Print lithium-7 abundance + error (and also He4 and D, as they are used in the likelihood)
  - purpose:      Observable
    capability:   BBN_abundances
    sub_capabilities: [Li7]

  # ---- Neutron lifetime -----
  - purpose:      LogLike
    capability:   lnL_neutron_lifetime_bottle

  # ---- CMB -----
  - purpose:      LogLike
    capability:   Planck_highl_loglike
    function:     function_Planck_highl_TTTEEE_lite_2018_loglike

  - purpose:      LogLike
    capability:   Planck_lensing_loglike
    function:     function_Planck_lensing_2018_loglike

  - purpose:      LogLike
    capability:   Planck_lowl_loglike
    function:     function_Planck_lowl_TTEE_2018_loglike

  # ---- Late-time cosmology (MontePython Likelihoods) -----
  - purpose:      LogLike
    capability:   MP_Combined_LogLike
    module:       CosmoBit
    type:         double
    sub_capabilities:
      bao_boss_dr12: default
      bao_smallz_2014: default
      Pantheon: default

  - purpose:          Observable
    capability:       MP_LogLikes
    type:             map_str_dbl

  # ---- Axion (astrophysical likelihoods) -----
  - purpose:      LogLike
    capability:   lnL_SN1987A
    module:       DarkBit
    type:         double

  - purpose:      LogLike
    capability:   lnL_RParameter
    module:       DarkBit
    type:         double

  # ---- Simplified X-ray likelihoods (derived from sterile neutrino bounds) -----
  - purpose:      LogLike
    capability:   lnL_Xray_M31_sterile_nu
    module:       DarkBit
    type:         double

  - purpose:      LogLike
    capability:   lnL_Xray_Integral_SPI_sterile_nu
    module:       DarkBit
    type:         double

  - purpose:      LogLike
    capability:   lnL_Xray_NuSTAR_sterile_nu
    module:       DarkBit
    type:         double

  # ---- Further GeneralCosmoALP Observables -----
  - purpose:      Observable
    capability:   lifetime
    type:         double

  - purpose:      Observable
    capability:   DM_fraction
    type:         double

  - purpose:      Observable
    capability:   minimum_fraction
    type:         double

  - purpose:      Observable
    capability:   etaBBN_rBBN_rCMB_dNurBBN_dNurCMB_parameters
    type:         ModelParameters

Rules:

  - capability: AlterBBN_Input
    options:
      failsafe: 3
      err: 0

  - capability: BBN_abundances
    options:
      isotope_basis: [Yp, D, He3, Be7, Li7]
      correlation_matrix: [[+1.000e00, +1.524e-2, +2.667e-2, +2.303e-2, +2.429e-2],
                           [+1.524e-2, +1.000e00, -8.160e-1, -3.775e-1, -3.653e-1],
                           [+2.667e-2, -8.160e-1, +1.000e00, +3.897e-1, +3.780e-1],
                           [+2.303e-2, -3.775e-1, +3.897e-1, +1.000e00, +9.974e-1],
                           [+2.429e-2, -3.653e-1, +3.780e-1, +9.974e-1, +1.000e00]]
      relative_errors: [1.348e-3, 1.596e-2, 1.618e-2, 6.788e-2, 6.579e-2]

  - capability: DarkAges_1_2_0_init
    options:
      f_eff_mode: false    # Calculate the single f_eff(z) rather than the full f_c(z) table? By default f_c(z) is calculated
      print_table: false   # Print the table to stdout. Useful for debugging
      z_max: 1.e7          # Constant continuation of efficiency table up to a given redshift. (f(z) = const. for 2.7e3 < z < z_max)

  - capability: external_dNeff_etaBBN
    options:
      grid_size: 3000   # set grid size of time grid to solve differntial equation to compute dNeff and etaBBN for CosmoALP model (default: 3000)
      max_iter: 8       # set max. number of iterations until convergence (of default 1e-6 accuracy) is reached. If not: point invalidated

  - capability: lifetime
    function: lifetime_ALP_agg
    # options:
    #  cut_tau_below: 0.0
    #  cut_tau_above: 1e17

  - capability: classy_MPLike_input
    function: set_classy_input_with_MPLike
    module: CosmoBit

#======== Logging setup ========
Logger:
  redirection:
    [Debug]        : "debug.log"
    [Default]      : "default.log"

#======== Generic Name/Value Section ========
KeyValues:

  debug: true

  default_output_path: "runs/CosmoBit_example_ALPs"

  likelihood:
    model_invalid_for_lnlike_below: -1e30
