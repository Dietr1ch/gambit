##########################################################################
## Test CosmoBit Likelihoods
##   - Using random sampler
##   - Using the Planck-lite likelihood for high-l
##     (Either TT or TTTEEE -> Specified in 'Rules')
##   - Using BBN Likelihood
##   - Using BAO Likelihood
##   - Using Sigma8 Likelihood
##   - Computing local H0 Likelihood as observable
##
##  To test this you need to make the backends 'class', 'alterbbn' and 'plc'.
##  You also need to download the Planck data and set the path to it in the
##  rules for 
##  - capability: plc_2_0_init
##    options:
##      planck_path: path/to/your/planck/data
##
## Janina Renk <janina.renk@fysik.su.se>
## 2018 Nov
##########################################################################


#======== Input parameter declarations =======
Parameters:
 
 # --- import model parameters for models to scan over ---
 LCDM: !import include/LCDM_scan.yaml        # base LCDM
 #LCDM_dNeffCMB: !import include/LCDM_dNeffCMB_scan.yaml
 #LCDM_dNeffCMB_dNeffBBN: !import include/LCDM_dNeffCMB_dNeffBBN_scan.yaml
 #LCDM_dNeffCMB_dNeffBBN_etaBBN: !import include/LCDM_dNeffCMB_dNeffBBN_etaBBN_scan.yaml

 # neutrino masses
 #StandardModel_numass_single: !import include/StandardModel_numass_single_scan.yaml
 StandardModel_numass_degenerate: !import include/StandardModel_numass_degenerate_scan.yaml

 # Cosmological nuisance parameters (except for Planck CMB Likelihoods) 
 cosmo_nuisance_params_Pantheon: !import include/cosmo_nuisance_params_Pantheon.yaml

#======== Prior setup ========
Priors:

#======== Output setup ========
Printer:
  printer: ascii
  options:
    output_file: "gambit_output.data"
    buffer_length: 100

#======== Scanner setup ========
Scanner:
  use_scanner: random

  scanners:
    multinest:
      plugin: multinest
      like:  LogLike
      nlive: 1000
      tol: 0.01
      aux_printer_txt_options:
      aux_printer_stats_options:
      aux_printer_live_options:

    random:
      plugin: random
      point_number: 2
      like:  LogLike

#======== Observables of interest ========
ObsLikes:
 
  - purpose:      Obs
    capability:   Omega0_m
    function:     get_Omega0_m_classy 

  - purpose:      Obs
    capability:   Omega0_b
    function:     get_Omega0_b_classy
  
  - purpose:      Obs
    capability:   Omega0_cdm
    function:     get_Omega0_cdm_classy
  
  - purpose:      Obs
    capability:   Omega0_r
    function:     get_Omega0_r_classy
  
  - purpose:      Obs
    capability:   Omega0_g
    function:     get_Omega0_g_classy
  
  - purpose:      Obs
    capability:   Omega0_ur
    function:     get_Omega0_ur_classy

  - purpose:      Obs
    capability:   Omega0_ncdm
    function:     get_Omega0_ncdm_classy  

  - purpose:      Obs
    capability:   Sigma8
    function:     get_Sigma8_classy

  - purpose:      Obs
    capability:   rs_drag
    function:     get_rs_drag_classy
  
  - purpose:      LogLike
    capability:   MP_Combined_LogLike
    module:       CosmoBit
    type:         double
  
  - purpose:      Observable
    capability:   MP_LogLikes
    type:         map_str_dbl
#
  #- purpose:      LogLike
  #  capability:   cap_test_classy
  #  module:       CosmoBit
  #  type:         double

#======== Rule entries ========
Rules:

  - capability: AlterBBN_setInput
    options:
      failsafe: 1
      err: 0

  - capability: set_classy_parameters
    function: set_classy_parameters_LCDM
    options:
      #l_max: 1000
      output: "lCl pCl tCl mPk"

  - capability: get_Classy_cosmo_container
    function: init_Classy_cosmo_container_with_MPLike
    module: CosmoBit

  - capability: MP_experiment_names
    function: set_MP_experiment_names
    options:
      Likelihoods: ["bao","Pantheon","Planck_SZ",]  
      # should eventually be possible to choose any MP like, atm only bao, Pantheon, Planck_SZ (& kids after 
      # downloading data and when commenting out line 'parser_mp.existing_file(fname)') safe to use
      # still need to write a proper patch for MPLike backend & test all Likes

  - capability: T_cmb
    options:
      T_cmb: 2.7255

#======== Logging setup ========
Logger:
  redirection:
    [Debug]      : "debug.log"
    [Default]      : "default.log"
    [CosmoBit]  : "CosmoBit.log"
    [Scanner]      : "Scanner.log"

#======== Generic Name/Value Section ========
KeyValues:

  debug: true

  default_output_path: "runs/CosmoBit_testMP"

  rng: ranlux48

  likelihood:
    model_invalid_for_lnlike_below: -1e6
