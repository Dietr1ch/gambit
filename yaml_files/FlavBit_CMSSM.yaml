##########################################################################
## GAMBIT configuration for running a Diver scan of the CMSSM using
## only FlavourBit likelihoods.
##
## alpha_s and the top mass are treated as SM nuisance parameters.
##########################################################################

# NB: This example yaml file uses flexiblesusy, so make sure you have
# built gambit with -DBUILD_FS_MODELS="CMSSM"


Parameters:

  # SM parameters.
  StandardModel_SLHA2: !import include/StandardModel_SLHA2_scan.yaml

  # SUSY parameters.
  CMSSM:
    M0:
      range: [50, 1e4]
      prior_type: log
    M12:
      range: [50, 1e4]
      prior_type: log
    A0:
      range: [-1e4, 1e4]
      flat_start: -1e2
      flat_end: 1e2
      prior_type: double_log_flat_join
    TanBeta:
      range: [3.0, 70]
    SignMu: 1


Priors:

  # All the priors are simple for this scan, so they are specified directly in the Parameters section.


Printer:

  printer: hdf5

  options:
    output_file: "CMSSM.hdf5"
    group: "/CMSSM"


Scanner:

  use_scanner: de

  scanners:

    multinest:
      plugin: multinest
      like:  LogLike
      nlive: 5000
      tol: 0.1
      updInt: 1

    de:
      plugin: diver
      like: LogLike
      NP: 19200
      convthresh: 1e-5
      verbosity: 1
      lambdajDE: false


ObsLikes:

    # Flavour physics likelihoods
    - purpose:    LogLike
      capability: B2mumu_LogLikelihood_LHCb

    - purpose:    LogLike
      capability: B2mumu_LogLikelihood_CMS

    - purpose:    LogLike
      capability: B2mumu_LogLikelihood_Atlas

    - purpose:    LogLike
      capability: SL_LL

    - purpose:    LogLike
      capability: B2KstarmumuAng_LogLikelihood_Atlas

    - purpose:    LogLike
      capability: B2KstarmumuAng_LogLikelihood_CMS

    - purpose:    LogLike
      capability: B2KstarmumuAng_LogLikelihood_Belle

    - purpose:    LogLike
      capability: B2KstarmumuAng_LogLikelihood_LHCb

    - purpose:    LogLike
      capability: b2sgamma_LogLikelihood

    - purpose:    LogLike
      capability: RK_LogLikelihood

    - purpose:    LogLike
      capability: RKstar_LogLikelihood_LHCb

    # SM nuisance parameter likelihoods
    - capability: lnL_t_mass
      purpose:    LogLike

    - capability: lnL_alpha_s
      purpose:    LogLike

    - capability: SuperIso_obs_values
      purpose:    test


Rules:

  # Tell all functions that are able to dump SLHA files to do so.
  #- options:
  #    drop_SLHA_file: true

  # Globally permit maximal mixing between gauge and family eigenstates
  - options:
      gauge_mixing_tolerance: 0.5
      family_mixing_tolerance: 0.5

  # Choose to use gm2calc for g-2
  - capability: muon_gm2
    function: GM2C_SUSY

  # Choose to base the SM prediction for g-2 on e+e- data
  - capability: muon_gm2_SM
    function: gm2_SM_ee

  # Use SM theory covariance matrix for every point
  - capability: SuperIso_theory_covariance
    function: SI_theory_covariance_SM

  # Use SuperIso instead of FeynHiggs for b->sgamma
  - capability: prediction_b2sgamma
    function: SuperIso_prediction_b2sgamma

  # Use SuperIso instead of FeynHiggs for B_s->mumu
  - capability: SuperIso_prediction_B2mumu
    function: SuperIso_prediction_B2mumu

  # Define observables to predict
  - capability: prediction_B2mumu
    options:
      obs_list: [BRuntag_Bsmumu, BR_Bdmumu]

  # Define observables used in Likelihood
  - capability: B2mumu_LogLikelihood_.*
    options:
      obs_list: [BRuntag_Bsmumu, BR_Bdmumu]

  # Define observables to predict
  - capability: prediction_B2KstarmumuAng_.*_Atlas
    options:
      obs_list: [FL, S3, S4, S5, S7, S8]

  # Define observables used in Likelihood
  - capability: B2KstarmumuAng_LogLikelihood_Atlas
    options:
      obs_list: [FL, S3, S4, S5, S7, S8]

  # Define observables to predict
  - capability: prediction_B2KstarmumuAng_.*_CMS
    options:
      obs_list: [P1, P5prime]

  # Define observables used in Likelihood
  - capability: B2KstarmumuAng_LogLikelihood_CMS
    options:
      obs_list: [P1, P5prime]

  # Define observables to predict
  - capability: prediction_B2KstarmumuAng_.*_Belle
    options:
      obs_list: [P4prime, P5prime]

  # Define observables used in Likelihood
  - capability: B2KstarmumuAng_LogLikelihood_Belle
    options:
      obs_list: [P4prime, P5prime]

  # Define observables to predict
  - capability: prediction_B2KstarmumuAng_.*_LHCb
    options:
      obs_list: [FL, AFB, S3, S4, S5, S7, S8, S9]

  # Define observables used in Likelihood
  - capability: B2KstarmumuAng_LogLikelihood_LHCb
    options:
      obs_list: [FL, AFB, S3, S4, S5, S7, S8, S9]

  # Choose to get decays from DecayBit proper, not from an SLHA file.
  - capability: decay_rates
    function: all_decays

  # Choose where to get the precision spectrum from
  - capability: MSSM_spectrum
    type: Spectrum
    function: make_MSSM_precision_spectrum_none


Logger:

  redirection:
    [Debug] : "debug.log"
    [Default] : "default.log"
    [DecayBit] : "DecayBit.log"
    [PrecisionBit] : "PrecisionBit.log"
    [FlavBit] : "FlavBit.log"
    [SpecBit] : "SpecBit.log"
    [Dependency Resolver] : "dep_resolver.log"


KeyValues:

  dependency_resolution:
    prefer_model_specific_functions: true

  likelihood:
    model_invalid_for_lnlike_below: -5e5
    model_invalid_for_lnlike_below_alt: -1e5

  default_output_path: "runs/FlavBit_CMSSM/"

  debug: true
