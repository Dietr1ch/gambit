##########################################################################
## GAMBIT configuration for a diver scan of the Dirac DM Simplified model
##########################################################################


Parameters:

  # SM parameters.
  StandardModel_SLHA2: !import include/StandardModel_SLHA2_defaults.yaml

  StandardModel_Higgs:
    mH: 125.09

  DMsimpVectorMedDiracDM:
    MXd:
      range: [50,10000]
      prior_type: log
    MY1:
      range: [50,10000] 
      prior_type: log
    gVXd:
      range: [0.01,3.0]
      prior_type: log
    gAXd:
      range: [0.01,3.0]
      prior_type: log
    gVq:
      range: [0.01,1.0]
      prior_type: log
    gAq: 0.0
    
  # NFW profile
  Halo_gNFW_rho0:
    rho0:
      range: [0.2, 0.8]
    v0:
      range: [216, 264]
    vesc:
      range: [453, 603]
    vrot:
      same_as: Halo_gNFW_rho0::v0
    rs: 20.0
    r_sun: 8.5
    alpha: 1
    beta: 3
    gamma: 1

  # Chiral nuclear parameters for DirectDM
  nuclear_params_ChPT_sigmapiN: !import include/nuclear_params_ChPT_sigmapiN_scan.yaml


Priors:

Printer:

  #printer: cout

  printer: hdf5
  options:
    output_file: "DMsimpDiracDM.hdf5"
    delete_file_on_restart: true
    buffer_length: 1000
    group: "/DMsimpDiracDM_Scan"


Scanner:

  use_scanner: random

  scanners:

    random:
      plugin: random
      like: LogLike
      point_number: 1

    diver:
      plugin: diver
      like: LogLike
      NP: 10000
      verbosity: 1
      convthresh: 1E-6

ObsLikes:

  # Unitarity Bounds
  - purpose: LogLike
    capability: Unitarity_Bound_DMsimpVectorMedDiracDM

  # LHC likelihoods
  - purpose:    LogLike
    capability: LHC_Combined_LogLike
    module:     ColliderBit
    type: double
    
  - purpose:    Observable
    capability: LHC_signals
    
  - purpose:    Observable
    capability: LHC_LogLike_per_SR

  - purpose:    likelihood_details
    capability: LHC_LogLike_SR_indices
    
  # DiJet  
  - purpose:      LogLike
    capability:   Recast_Dijet_Likelihood_DMsimp

  # Direct Detection
  - capability: LUX_2016_LogLikelihood
    purpose:    LogLike

  - capability: XENON1T_2018_LogLikelihood
    purpose:    LogLike

  - capability: PandaX_2016_LogLikelihood
    purpose:    LogLike

  - capability: PandaX_2017_LogLikelihood
    purpose:    LogLike

  - capability: PICO_60_2017_LogLikelihood
    purpose:    LogLike

  - capability: PICO_60_2019_LogLikelihood
    purpose:    LogLike

  - capability: CRESST_III_LogLikelihood
    purpose:    LogLike

  - capability: CRESST_II_LogLikelihood
    purpose:    LogLike

  - capability: CDMSlite_LogLikelihood
    purpose:    LogLike

  - capability: DarkSide_50_LogLikelihood
    purpose:    LogLike
    
  # Predicted signal at LZ experiment
  - capability: LZ_Signal
    purpose:    ObsLike

  # Indirect Detection
  - capability: lnL_FermiLATdwarfs
    purpose:    LogLike

  - capability: sigmav
    purpose:    Observable

  # Relic Density
  - capability: lnL_oh2
    purpose:    LogLike

  - capability: RD_oh2
    purpose: Observable
  
    
Rules:
  
  # Choose to get decay rates from DecayBit proper, not an SLHA file
  - capability: decay_rates
    function: all_decays

  # Use LHC analyses based on fast interpolation rather than on-the-fly MC simulation
  - capability: RunMC
    function: InterpolatedMCInfo 
    module: ColliderBit
    
  - capability: LHC_Combined_LogLike
    options:
      # Do not use capped LHC loglike, change to true if desired
      cap_loglike: false
      # Choose to use the CMS 137 invfb search rather than CMS36invfb
      skip_analyses:
        - CMS_13TeV_MONOJET_36invfb_interpolated

  - capability: LHC_LogLikes
    backends:
    - {capability: lnlike_marg_poisson_lognormal_error}
    options:
      use_covariances: true
      combine_SRs_without_covariances: false
      use_marginalising: false
      nuisance_prof_initstep: 0.1
      nuisance_prof_convtol: 0.01
      nuisance_prof_maxsteps: 10000
      nuisance_prof_convacc: 0.01
      nuisance_prof_simplexsize: 1e-5
      nuisance_prof_method: 5
      nuisance_prof_verbosity: 0

    # Signal yields for LHC analyses 
  - capability: AllAnalysisNumbers
    function: DMsimpVectorMedDiracDM_results
    
  # Relic density likelihood
  - capability: lnL_oh2
    #Choose either lnL_oh2_upperlimit or lnL_oh2_Simple
    function: lnL_oh2_upperlimit
    options: # Planck 2018 values
      oh2_obs: 0.120
      oh2_obserr: 0.001
      oh2_fractional_theory_err: 0.01

    options: # Planck 2018 values
      oh2_obs: 0.120
      oh2_obserr: 0.001
      oh2_fractional_theory_err: 0.01

  # Choose to rescale signals in direct and indirect detection by the relic density fraction
  - capability: RD_fraction
    function: RD_fraction_leq_one
    options: # Planck 2018 values
      oh2_obs: 0.120

  - capability: RD_oh2
    function: RD_oh2_DS_general
    options:
      fast: 1  # 0: standard, 1: fast (default)

  # Choose between the functions sigmav_late_universe and sigmav_late_universe_MicrOmegas
  - capability: sigmav
    function: sigmav_late_universe
    
    
  # Choose to use DarkSUSY yield tables for indirect detection
  - capability: GA_SimYieldTable
    function: GA_SimYieldTable_DarkSUSY
    options:
      allow_yield_extrapolation: true

  # Also need to choose which tables to use for positrons,
  # antideuterons, and antiprotons (or opt for empty tables)
  - capability: positron_SimYieldTable
    function: positron_SimYieldTable_DarkSUSY

  - capability: antiproton_SimYieldTable
    function: antiproton_SimYieldTable_DarkSUSY

  - capability: antideuteron_SimYieldTable
    function: antideuteron_SimYieldTable_DarkSUSY

  # Take the electron yields directly from the positron yields
  - capability: electron_SimYieldTable
    function: electron_SimYieldTable_from_positron_SimYieldTable

  # The model is annihilating DM, not decaying
  - capability: GA_Yield
    function: GA_AnnYield_General

  - capability: electron_Yield
    function: electron_AnnYield_General

  - capability: positron_Yield
    function: positron_AnnYield_General

  - capability: capture_rate_Sun
    function: capture_rate_Sun_NREO

  # Feed non-relativistic couplings into DDCalc
  - capability: DDCalc_Couplings
    function: DDCalc_Couplings_NR_WCs

  - capability: DD_nonrel_WCs
    function: DD_nonrel_WCs_flavscheme
    module: DarkBit


Logger:

  redirection:
    [Default] : "default.log"

KeyValues:

  dependency_resolution:
    prefer_model_specific_functions: true

  likelihood:
    model_invalid_for_lnlike_below: -5e7
    model_invalid_for_lnlike_below_alt: -1e7

  default_output_path: "runs/DMsimpDiracDM/"

  debug: true

