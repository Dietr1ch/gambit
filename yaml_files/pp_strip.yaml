# This is a simple example usage of the postprocessor scanner to 
# strip 'invalid' points out of GAMBIT output.
#
# Here we do this by setting a cut to keep only points above
# an extremely small likelihood threshold, such that only 
# invalid points would fail it.
#
# To test this out, please first run yaml_files/spartan.yaml 
# to generate the output which we will postprocess

Parameters:

Priors:

Printer:

  printer: hdf5

  options:
    output_file: "spartan_pp.hdf5"
    group: "/spartan"
    disable_combine_routines: false

Scanner:

  use_scanner: postprocess

  scanners:

    postprocess:

      plugin: postprocessor
      # Name of the new global likelihood contribution. This will be zero in this simple example
      like: New_LogLike 
       
      # Add LogLike in the old output to New_LogLike in the new output.   
      add_to_like: [LogLike]                                             
      # Allow overwriting of the old output with the new output.
      permit_discard_old_likes: true
      ## This will appear alongside New_Loglike, which will be the new things only.
      reweighted_like: LogLike       
      # Interval between progress reports to stdout (0=none, default 1000)
      update_interval: 1000
 
      # Restrict postprocessing to values greater than this
      cut_greater_than: {"LogLike": -1e99} # Super tiny value in log space!
      # Throw away all points outside the cuts
      discard_points_outside_cuts: true

      # Choose the input stream
      reader:
        type: hdf5
        file: "runs/spartan/samples/results.hdf5_temp_combined"
        group: "/spartan"

ObsLikes:

Rules:

Logger:

  redirection:
    [Default] : "default.log"

KeyValues:

  dependency_resolution:
    prefer_model_specific_functions: true

  likelihood:
    model_invalid_for_lnlike_below: -5e5
    model_invalid_for_lnlike_below_alt: -1e5

  default_output_path: "runs/spartan_pp"
