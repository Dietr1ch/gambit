#######################################################
##  Minimal test of inflation models in CosmosBit    ##
##                                                   ##
##  Selim Hotinli <selim.hotinli14@imperial.ac.uk>   ##
##    2016-17                                        ##
##  Sebastian Hoof <hoof@uni-goettingen.de>          ##
##    2020                                           ##
##  Values taken from base2015.bestfit MontePython.  ##
#######################################################


#======== Input parameter declarations =======
Parameters:
  StandardModel_mNudiff: !import include/StandardModel_mNudiff_NH_scan.yaml

  # nuisance parameters for Planck likelihood
  #  => if you don't include the Planck likelihoods into the scan you should get a FATAL Error
  #     telling you that no function requires any of the model parameters, comment this line out
  #     to fix it
  # (try to comment this line or the Planck likelihoods then you can see the different error messages)
  cosmo_nuisance_Planck_lite: !import include/Planck_2018/cosmo_nuisance_Planck_lite_flat.yaml

  LCDM:
    omega_b:
      fixed_value: 2.24052e-02
    omega_cdm:
      fixed_value: 1.18078e-01
    H0:
      fixed_value: 6.81383e+01
    tau_reio:
      fixed_value: 7.25805e-02
    T_cmb: 2.72548

  Inflation_InstReh_1quartic:
    lambda: 1.0e-10

  dNurCMB:
    dNur_CMB: 0.01

#======== Prior setup ========
Priors:

#======== Output setup ========
Printer:
  printer: cout
  options:
    output_file: "results.data"
    buffer_length: 3

#======== Scanner setup ========
Scanner:
  use_scanner: random

  scanners:
    multinest:
      plugin: multinest
      like:  LogLike
      nlive: 500
      tol: 0.3
      aux_printer_txt_options:
      aux_printer_stats_options:
      aux_printer_live_options:

    random:
      plugin: random
      point_number: 10
      like:  LogLike

#======== Observables of interest ========
ObsLikes:
  - purpose:      LogLike
    capability:   BBN_LogLike
    sub_capabilities: D

  - purpose:      LogLike
    capability:   Planck_lowl_loglike
    function:     function_Planck_lowl_TTEE_2018_loglike

  - purpose:      LogLike
    capability:   MP_Combined_LogLike
    module:       CosmoBit
    type:         double
    sub_capabilities:
      hst: default

  - purpose:      Observable
    capability:   PowerLaw_ps_parameters
    type:         ModelParameters

#======== Rule entries ========
Rules:

  - capability: multimode_input_parameters
    function: set_multimode_inputs
    options:
# Parameters to be passed to the potential
      k_pivot:                  0.01
      dlnk:                     0.4
# For calculating the full power spectrum P(k).  Samples in uniform increments in log(k).
      numsteps: 500
      k_min: 1e-7
      k_max: 1e6

  - capability: get_classy_cosmo_object
    function: get_classy_cosmo_object
    backends:
    - {capability: get_classy_cosmo_object, backend: classy, version: 2.6.3}

  - capability: classy_MPLike_input
    function: set_classy_input_with_MPLike

  - capability: classy_primordial_input
    #function: set_classy_parameters_primordial_ps
    function: set_classy_parameters_parametrised_ps

  - capability: classy_input_params
    #function: set_classy_baseline_params
    options:
      classy_dict:
        #output: tCl  
        #k_pivot: 0.03

  # error calculation precision settings for AlterBBN
  # (use 1 and 0 to speed up Helium abundance calculation for testing)
  - capability: AlterBBN_Input
    options:
      failsafe: 1
      err: 0

#======== Logging setup ========
Logger:
  redirection:
    [Default]      : "default.log"
    [CosmoBit]     : "CosmoBit.log"

#======== Generic Name/Value Section ========
KeyValues:
  default_output_path: "runs/inflation-test"
  debug: true
  print_timing_data: true
  likelihood:
    model_invalid_for_lnlike_below: -1e6
