######################################################
## GAMBIT configuration file for the Cosmo ALP project
##
## Option: Log priors
## 
## \author Tomas Gonzalo
##         (gonzalo@physik.rwth-aachen.de)
##
######################################################


Parameters:

  LCDM_zreio:
    omega_b:
      prior_type: flat
      range: [0.020,0.024]
    omega_cdm:
      prior_type: flat
      range: [0.10,0.13]
    H0:
      prior_type: flat
      range: [62,74]
    T_cmb:
      fixed_value: 2.72548
    z_reio:
      prior_type: flat
      range: [4.5,9.5]

  PowerLaw_ps:
    ln10A_s:
      prior_type: flat
      range: [2.9,3.2]
    n_s:
      prior_type: flat
      range: [0.9,1.10]
    r: 0
    N_pivot: 55

  StandardModel_SLHA2: !import include/StandardModel_SLHA2_Planckbaseline.yaml

  CosmoALP_gg_tau:
    tau:
      range: [1e5, 1e13]
      prior_type: log
    ma0:
      range: [1e3, 1e8]
      prior_type: log
    f0_thermal:
      range: [1e-12, 1e2]
      prior_type: log
    fa: 1e9
    thetai: 0.0
    T_R: 5.0
    beta: 0.0
    Tchi: 1e99

  cosmo_nuisance_Planck_lite: !import include/Planck_2018/cosmo_nuisance_Planck_lite_flat.yaml

  cosmo_nuisance_Pantheon:
    M:
      prior_type: flat
      range: [-20,-18]

  cosmo_nuisance_SpectralDistortions: !import include/cosmo_nuisance_SpectralDistortions_fid.yaml

  nuclear_params_neutron_lifetime:
    neutron_lifetime:
      range: [875,895]

  rBBN_dNurBBN:
    r_BBN: 1.0
    dNur_BBN: 0.0

Priors:

Printer:

  #printer: cout

  printer: hdf5
  options:
    output_file: "CosmoALP.hdf5"
    group: "/CosmoALP"
    delete_file_on_restart: false
    buffer_length: 100

Scanner:

  use_scanner: diver

  scanners:

    random:
      plugin: random
      point_number: 20
      like:  LogLike

    diver:
      plugin: diver
      like: LogLike
      convthresh: 1e-7
      verbosity: 2
      NP: 20000
      jDE: true
      lambdajDE: false

ObsLikes:

  # ---- BBN -----
  # Likelihood from BBN, including helium3, helium4 and deuterium abundances
  - purpose:      LogLike
    capability:   BBN_LogLike
    sub_capabilities: [He3, He4, D]

  # Print lithium-7 abundance + error (and also He4 and D, as they are used in the likelihood)
  - purpose:      Observable
    capability:   BBN_abundances
    sub_capabilities: [Li7]

  # Print abundances after photodissociation
  - purpose:      Observable
    capability:   BBN_abundances_photodissociation

  # ---- Neutron lifetime -----
  - purpose:      LogLike
    capability:   lnL_neutron_lifetime_bottle

  # ---- CMB -----
  - purpose:      LogLike
    capability:   Planck_nuisance_prior_loglike

  - purpose:      LogLike
    capability:   Planck_highl_loglike
    function:     function_Planck_highl_TTTEEE_lite_2018_loglike

  - purpose:      LogLike
    capability:   Planck_lensing_loglike
    function:     function_Planck_lensing_2018_loglike

  - purpose:      LogLike
    capability:   Planck_lowl_loglike
    function:     function_Planck_lowl_TTEE_2018_loglike

  # ---- Late-time cosmology (MontePython Likelihoods) -----
  - purpose:      LogLike
    capability:   MP_Combined_LogLike
    sub_capabilities:
      - bao_boss_dr12
      - bao_smallz_2014
      - Pantheon
      - firas
      #- pixie  # Can't run at the same time, might have to do after
      

  - purpose:          Observable
    capability:       MP_LogLikes
    type:             map_str_dbl

  # ---- Axion (astrophysical likelihoods) -----
  - purpose:      LogLike
    capability:   lnL_SN1987A
    module:       DarkBit
    type:         double

  - purpose:      LogLike
    capability:   lnL_RParameter
    module:       DarkBit
    type:         double

  # ---- Further GeneralCosmoALP Observables -----
  - purpose:      Observable
    capability:   gagg
    type:         double

  - purpose:      Observable
    capability:   DM_fraction
    type:         double

  - purpose:      Observable
    capability:   minimum_fraction
    type:         double

  - purpose:      Observable
    capability:   tau_reio

Rules:

  - capability: AlterBBN_Input
    options:
      failsafe: 3
      #err: 0
      err: -12

  - capability: BBN_abundances
    options:
      isotope_basis: [Yp, D, He3, Li7, Li6, Be7]
      correlation_matrix: [[1.000000, 0.007222, 0.021811, 0.021834, 0.001870, 0.020412],
                           [0.007222, 1.000000, -0.799961, -0.358761, 0.010648, -0.371730],
                           [0.021811, -0.799961, 1.000000, 0.370224, -0.011028, 0.382648],
                           [0.021834, -0.358761, 0.370224, 1.000000, -0.003693, 0.996544],
                           [0.001870, 0.010648, -0.011028, -0.003693, 1.000000, -0.003809],
                           [0.020412, -0.371730, 0.382648, 0.996544, -0.003809, 1.000000]]
      diff_uncertainties: true
      # absolute_errors: [3.203e-04, 3.790e-07, 1.635e-07, 3.522e-11, 1.085e-14, 3.434e-11]
      # relative_errors: [1.29466e-03, 1.5369e-02, 1.58124e-02, 6.56477e-02, 9.9816e-01, 6.76517e-02]

  - capability: BBN_abundances_photodissociation
    options:
      verbose: false
      NE_pd: 30
      NT_pd: 10
      eps: 1e-1

  - capability: BBN_LogLike
    options:
      DataFile: default.dat

  - capability: DarkAges_1_2_0_init
    options:
      f_eff_mode: false    # Calculate the single f_eff(z) rather than the full f_c(z) table? By default f_c(z) is calculated
      print_table: false   # Print the table to stdout. Useful for debugging
      z_max: 1.e7          # Constant continuation of efficiency table up to a given redshift. (f(z) = const. for 2.7e3 < z < z_max)

  # Use the on the spot treatment for CMB energy injection
  - capability: classy_parameters_EnergyInjection
    function: set_classy_parameters_EnergyInjection_DecayingDM_onSpot

  - capability: f_eff
    function: f_eff_constant
    options:
      f_eff: 1.0

  - capability: classy_MPLike_input
    function: set_classy_input_with_MPLike

  - capability: parameter_dict_for_MPLike
    function: set_parameter_dict_for_MPLike

  # Use numerical results for the minimal abundance through freeze in.
  - capability: minimum_abundance
    #function: minimum_abundance_ALP_analytical
    function: minimum_abundance_ALP_numerical

  - capability: external_dNeff_etaBBN
    options:
      grid_size: 3000   # set grid size of time grid to solve differntial equation to compute dNeff and etaBBN for CosmoALP model (default: 3000)
      max_iter: 15      # set max. number of iterations until convergence (of default 1e-6 accuracy) is reached. If not: point invalidated


Logger:
  redirection:
    [Default]      : "default.log"
    [CosmoBit]     : "CosmoBit.log"
    [DarkBit]      : "DarkBit.log"

KeyValues:

  debug: false

  default_output_path: "runs/CosmoALP"

  likelihood:
    model_invalid_for_lnlike_below: -1e9
